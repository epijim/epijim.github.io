<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Contour mapping Cambridge crime • James Black</title>
    <meta name="description" content="Plotting Cambridge crime data on a map using R.">
    <meta name="keywords" content="r, map, cambridge">
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Contour mapping Cambridge crime">
	<meta name="twitter:description" content="Plotting Cambridge crime data on a map using R.">
	
	
	
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:image" content="https://epijim.uk/images/crimes_feature.jpg">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Contour mapping Cambridge crime">
	<meta property="og:description" content="Plotting Cambridge crime data on a map using R.">
	<meta property="og:url" content="https://epijim.uk/blog/crime-cambridge/">
	<meta property="og:site_name" content="James Black">
    <link rel="author" href="https://plus.google.com/https://plus.google.com/112022213613617220776/"/>

    <link rel="canonical" href="https://epijim.uk/blog/crime-cambridge/">

    <link href="https://epijim.uk/atom.xml" type="application/atom+xml" rel="alternate" title="James Black Atom Feed">
    <link href="https://epijim.uk/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <style>
    .sliding-menu-content {
      top: 0;
      right: 0;
      text-align: center;
      visibility: hidden;
      height: 100%;
      width: 100%;
      -webkit-transform: translateX(100%);
      -moz-transform: translateX(100%);
      -ms-transform: translateX(100%);
      -o-transform: translateX(100%);
      transform: translateX(100%);
    }
    </style>

    <link rel="stylesheet" href="https://epijim.uk/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="https://epijim.uk/js/vendor/html5shiv.min.js"></script>
      <script src="https://epijim.uk/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <header id="masthead">
<link rel="alternate" type="application/rss+xml" title="James Black" href="https://epijim.uk/atom.xml">
  <div class="inner-wrap">
    <a href="https://epijim.uk" class="site-title">James Black</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">James Black</a></li>
	
    
        
    
    <li><a href="https://epijim.uk/about/" >About</a></li>
  
    
        
    
    <li><a href="https://epijim.uk/my-papers/" >Papers</a></li>
  
    
        
    
    <li><a href="https://epijim.uk/code/" >Code</a></li>
  
    
        
    
    <li><a href="https://epijim.uk/blog/" >Blog</a></li>
  
    
        
    
    <li><a href="https://epijim.uk/courses/" >Courses</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

    <nav role="navigation" class="js-menu sliding-menu-content">
	<ul class="menu-item">
		<li>
      
        
      
			<a href="https://epijim.uk/about/"><img src="https://epijim.uk/images/about_thumb.jpeg" alt="teaser" class="teaser"></a>
			<a href="https://epijim.uk/about/" class="title">About</a>
			<p class="excerpt">Get more information on, or contact, James Black.</p>
		</li><li>
      
        
      
			<a href="https://epijim.uk/my-papers/"><img src="https://epijim.uk/images/papers_thumb.png" alt="teaser" class="teaser"></a>
			<a href="https://epijim.uk/my-papers/" class="title">Papers</a>
			<p class="excerpt">My published journal articles.</p>
		</li><li>
      
        
      
			<a href="https://epijim.uk/code/"><img src="https://epijim.uk/images/code_thumb.png" alt="teaser" class="teaser"></a>
			<a href="https://epijim.uk/code/" class="title">Code</a>
			<p class="excerpt">A collection of code snippets I think are really useful.</p>
		</li><li>
      
        
      
			<a href="https://epijim.uk/blog/"><img src="https://epijim.uk/images/blog_thumb.jpg" alt="teaser" class="teaser"></a>
			<a href="https://epijim.uk/blog/" class="title">Blog</a>
			<p class="excerpt">My data based blog.</p>
		</li><li>
      
        
      
			<a href="https://epijim.uk/courses/"><img src="https://epijim.uk/images/courses.jpg" alt="teaser" class="teaser"></a>
			<a href="https://epijim.uk/courses/" class="title">Courses</a>
			<p class="excerpt">Courses I've done relating to R or coding</p>
		</li>
	</ul>
</nav>
<button type="button" class="js-menu-trigger sliding-menu-button menulines-button x2" role="button" aria-label="Toggle Navigation">
	<span class="menulines"></span>
</button>

<div class="js-menu-screen menu-screen"></div>

    <div id="page-wrapper">
      <!--[if lt IE 9]><div class="upgrade notice-danger"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

      <div id="main" role="main">	
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
			<div class="page-feature-header overlay">
			
			<div class="page-image">
				<img src="https://epijim.uk/images/crimes_feature.jpg" class="page-feature-image" alt="Contour mapping Cambridge crime" itemprop="image">
				
			</div><!-- /.page-image -->
			
			<div class="page-title">
        	<h1><span>Contour mapping Cambridge crime</span></h1>
        	<div class="page-meta">
  
    <span>Filed under: <a href="/tag/r/" title="r" rel="tag">r</a>, <a href="/tag/map/" title="map" rel="tag">map</a>, <a href="/tag/cambridge/" title="cambridge" rel="tag">cambridge</a></span>
  
</div><!-- /.page-meta -->
			</div><!-- /.page-title -->
      	</div><!-- /.page-image-media -->
		<div class="inner-wrap">
			<nav class="toc"></nav><!-- /.toc -->
			<div id="content" class="page-content" itemprop="articleBody">
				<p>The Cambridge Constabulary <a href="http://data.police.uk/data/">has location data</a> on just over 280,000 crimes that have happened
 between December 2010 and October 2013. It’s just too great of a dataset not to take a look…</p>

<figure>
	<a href="/images/crimes_1.png"><img src="/images/crimes_1.png" /></a>
	<figcaption>Crime density across the county.</figcaption>
</figure>

<p>Not surprisingly, the majority of crimes take place where the people are.
 So what about in Cambridge?</p>

<p>Each point below is a crime, and they are coded by the 16 types of crime that the police
 have pre-categorised. I didn’t bother with a key, as 16 is just too much to
 get my head around at once.</p>

<figure>
	<a href="/images/crimes_2.png"><img src="/images/crimes_2.png" /></a>
	<figcaption>Two years of Cambridge crime plotted.</figcaption>
</figure>

<p>Below is the same map, focusing on the four types of crimes that looked interesting to me.</p>

<ul>
  <li>Antisocial behavior (I’m going to call them ASBOs, although really they are incidents not convictions or actual orders)</li>
  <li>Burglaries</li>
  <li>Drug related arrests</li>
  <li>Bicycle thefts</li>
</ul>

<figure>
	<a href="/images/crimes_3.png"><img src="/images/crimes_3.png" /></a>
	<figcaption>Stripping the 16 types down to just the four I'm interested in.</figcaption>
</figure>

<p>While it’s possible to see a possible clustering of bicycle thefts in the centre of town,
 and (not suprisingly) most burglaries seem to take place out of the centre,
 it’s still hard to make out any patterns.</p>

<p>So is there really difference on where the crimes happen? Overlying the four types gets
 really messy. Below is the same four crime types overlaid. I removed the map entirely as
 it’s already so cluttered, and I was mainly interested in how they overlapped.</p>

<figure>
	<a href="/images/crimes_4.png"><img src="/images/crimes_4.png" /></a>
	<figcaption>A rather messy contour plot of the four crimes densities.</figcaption>
</figure>

<p>Below is a density map of the 9 most common crimes. Shoplifting seems to be focused on the
 shopping malls, burglaries have a pretty decent spread. Interestingly,
 there isn’t many bikes stolen from West Cambridge.</p>

<figure>
	<a href="/images/crimes_5.png"><img src="/images/crimes_5.png" /></a>
	<figcaption>Nine types of crime as density plots.</figcaption>
</figure>

<p>Looking at the four most interesting (to me) in detail, below.</p>

<figure>
	<a href="/images/crimes_6.png"><img src="/images/crimes_6.png" /></a>
	<figcaption>Zooming in on just the four most interesting.</figcaption>
</figure>

<p>Over the last 2 years, and within the bounds of my Cambridge maps, there were:</p>

<ul>
  <li>16,534 ASBOs</li>
  <li>2535 burglaries</li>
  <li>1502 drug related incidents</li>
  <li>1100 bicycle thefts</li>
</ul>

<p>Before I can use these plots I need to work out how to set the density scale as constant.
 The scales of a density plot, at least to me, are pretty random (it went up to 2,200)
 for the plots above. As far as I can tell from the documentation, in the plot above,
 it’s a common scale across each panel of the plot, but if you look at the numbers,
 that doesn’t seem to be the case.</p>

<p>Below is the four plots individually, where the density limits vary. Definitely something
 I need to figure out before using these plots for real.</p>

<figure>
	<a href="/images/crimes_7.gif"><img src="/images/crimes_7.gif" /></a>
	<figcaption>Cycling through the types.</figcaption>
</figure>

<p>Below is the script to load up the csv’s, as you get them from
 <a href="http://data.police.uk/data/">the police website</a>.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">setwd</span><span class="p">(</span><span class="s">&quot;Directoy where the data is saved&quot;</span><span class="p">)</span>

<span class="kn">library</span><span class="p">(</span>plyr<span class="p">)</span> <span class="c1"># used to read in csvs</span>
<span class="kn">library</span><span class="p">(</span>psych<span class="p">)</span> <span class="c1"># has the describe function</span>

<span class="c1">################</span>
<span class="c1"># import data  #</span>
<span class="c1">################</span>

<span class="c1"># Data is in monthly CSV&#39;s, so loop over them pulling in data</span>

  <span class="c1"># CAREFUL this will get all .csv names in directory</span>
  temp_filenames <span class="o">=</span> <span class="kp">list.files</span><span class="p">(</span>pattern<span class="o">=</span><span class="s">&quot;*.csv&quot;</span><span class="p">)</span>

  <span class="c1">#Now we have a list of the csv names, read them into one data frame</span>
  crime_data <span class="o">&lt;-</span> ldply<span class="p">(</span>temp_filenames<span class="p">,</span> read.csv<span class="p">)</span>
  <span class="c1">#could do in full like below, but prefer the shorter method above using plyr</span>
  <span class="c1">#crime_data &lt;- do.call(&quot;rbind&quot;, lapply(temp, read.csv, header = TRUE))</span>

<span class="c1"># take a gander!</span>
  <span class="kp">head</span><span class="p">(</span>crime_data<span class="p">)</span>
  <span class="kp">summary</span><span class="p">(</span>crime_data<span class="p">)</span>
  describe<span class="p">(</span>crime_data<span class="p">)</span>
  str<span class="p">(</span>crime_data<span class="p">)</span>
  <span class="c1"># so 228, 949 crimes are in the database,</span>
  <span class="c1"># seems most the crime ID stuff came in later, and ties into the seperate</span>
  <span class="c1"># outcome data. Same with context. For now I&#39;ll focus on location,</span>
  <span class="c1"># time and type of crime</span>

  <span class="c1">#DATA ISSUES. Time is a factor variable.</span></code></pre></div>

<p>And now plot it.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">theme_bare <span class="o">&lt;-</span> theme<span class="p">(</span>axis.line <span class="o">=</span> element_blank<span class="p">(),</span>
                      axis.text.x <span class="o">=</span> element_blank<span class="p">(),</span>
                      axis.text.y <span class="o">=</span> element_blank<span class="p">(),</span>
                      axis.ticks <span class="o">=</span> element_blank<span class="p">(),</span>
                      axis.title.x <span class="o">=</span> element_blank<span class="p">(),</span>
                      axis.title.y <span class="o">=</span> element_blank<span class="p">(),</span>
                      legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span>

cambridge <span class="o">&lt;-</span> get_map<span class="p">(</span>location<span class="o">=</span><span class="s">&quot;Cambridge, UK&quot;</span><span class="p">,</span> zoom<span class="o">=</span><span class="m">13</span><span class="p">,</span> color<span class="o">=</span><span class="s">&quot;bw&quot;</span><span class="p">,</span> <span class="kn">source</span><span class="o">=</span><span class="s">&quot;osm&quot;</span><span class="p">)</span>

CambridgeMap <span class="o">&lt;-</span> ggmap<span class="p">(</span>cambridge<span class="p">,</span> baselayer <span class="o">=</span> ggplot<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>Longitude<span class="p">,</span> y<span class="o">=</span>Latitude<span class="p">),</span>
                                                    data<span class="o">=</span>crime_data<span class="p">))</span>

CambridgeMap <span class="o">+</span> stat_density2d<span class="p">(</span>aes<span class="p">(</span> x<span class="o">=</span>Longitude<span class="p">,</span>y<span class="o">=</span>Latitude<span class="p">,</span>
                                   fill<span class="o">=</span><span class="m">..</span>level.. <span class="p">,</span> alpha<span class="o">=</span><span class="m">..</span>level.. <span class="p">),</span>
                              data<span class="o">=</span>crime_data<span class="p">,</span> bins<span class="o">=</span><span class="m">6</span> <span class="p">,</span>geom <span class="o">=</span> <span class="s">&quot;polygon&quot;</span> <span class="p">)</span> <span class="o">+</span>
                              scale_fill_gradient<span class="p">(</span>low <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> high <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="o">+</span>
                              facet_wrap<span class="p">(</span><span class="o">~</span> Crime.type<span class="p">)</span> <span class="o">+</span> theme_bare</code></pre></div>


				<hr />
				<footer class="page-footer">
					


<div class="author-image">
	<img src="https://epijim.uk/images/bio-photo.jpg" alt="James Black">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <a href="http://epijim.uk" itemprop="author">James Black</a></h3>
	<p class="author-bio">Reading Epidemiology at Jesus College, University of Cambridge.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Contour%20mapping%20Cambridge%20crime&amp;url=https://epijim.uk/blog/crime-cambridge/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://epijim.uk/blog/crime-cambridge/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=https://epijim.uk/blog/crime-cambridge/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->
					<div class="page-meta">
	<p>Updated <time datetime="2014-10-19T00:00:00Z" itemprop="datePublished">October 19, 2014</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<div class="entry-related">
					<h4>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="https://epijim.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h4>
					<ul>
						
						<li><a href="https://epijim.uk/papers/paper5/">Parental perception of child obesity</a></li>
						
						<li><a href="https://epijim.uk/blog/when-cam-nice-app/">When is it nice in Cambridge (interactive app)?</a></li>
						
						<li><a href="https://epijim.uk/blog/when-cam-nice/">When is it nice in Cambridge?</a></li>
						
						<li><a href="https://epijim.uk/blog/pub-crawl/">Optimum pub crawl route through all 71 Cambridge pubs</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<aside>
				<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'jamesblack';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		<div class="ads"><style>
.responsive-ads { width: 300px; height: 200px; }
@media(min-width: 520px) { .responsive-ads { width: 468px; height: 60px; } }
@media(min-width: 768px) { .responsive-ads { width: 160px; height: 600px; } }
</style>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle responsive-ads"
	style="display:inline-block"
	data-ad-client="ca-pub-8433594162604860"
	data-ad-slot="9138304032"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div><!-- /.ads -->
	</article><!-- /.wrap -->
</div><!-- /#main -->



      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="https://epijim.uk/" >Home</a></li>
		
      
        
      
			<li><a href="https://epijim.uk/my-papers/" >Papers</a></li>
		
      
        
      
			<li><a href="https://epijim.uk/about/" >About</a></li>
		
      
        
      
			<li><a href="https://epijim.uk/terms/" >Legal</a></li>
		
      
        
        
			<li><a href="http://www.r-bloggers.com" target="_blank">R bloggers</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2015 <a href="https://epijim.uk">James Black</a> hosted by <a href="https://pages.github.com">Github</a> and powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
<!-- google analytics -->	
<script> 
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'auto');
  ga('send', 'pageview');

</script>
</footer>
    </div>

    <script src="https://epijim.uk/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="https://epijim.uk/js/main.js"></script>
    
    

  </body>

</html>
