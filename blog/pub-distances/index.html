<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Distance to the nearest pub • James Black</title>
    <meta name="description" content="Building a matrix of the distance to the nearest pub using FSA and google data.">
    <meta name="keywords" content="r, geocoding">
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Distance to the nearest pub">
	<meta name="twitter:description" content="Building a matrix of the distance to the nearest pub using FSA and google data.">
	
	
	
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:image" content="http://epijim.uk/images/pub_feature.jpg">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Distance to the nearest pub">
	<meta property="og:description" content="Building a matrix of the distance to the nearest pub using FSA and google data.">
	<meta property="og:url" content="http://epijim.uk/blog/pub-distances/">
	<meta property="og:site_name" content="James Black">
    <link rel="author" href="https://plus.google.com/https://plus.google.com/112022213613617220776/"/>

    <link rel="canonical" href="http://epijim.uk/blog/pub-distances/">

    <link href="http://epijim.uk/atom.xml" type="application/atom+xml" rel="alternate" title="James Black Atom Feed">
    <link href="http://epijim.uk/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <style>
    .sliding-menu-content {
      top: 0;
      right: 0;
      text-align: center;
      visibility: hidden;
      height: 100%;
      width: 100%;
      -webkit-transform: translateX(100%);
      -moz-transform: translateX(100%);
      -ms-transform: translateX(100%);
      -o-transform: translateX(100%);
      transform: translateX(100%);
    }
    </style>

    <link rel="stylesheet" href="http://epijim.uk/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://epijim.uk/js/vendor/html5shiv.min.js"></script>
      <script src="http://epijim.uk/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <header id="masthead">
  <div class="inner-wrap">
    <a href="http://epijim.uk" class="site-title">James Black</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">James Black</a></li>
	
    
        
    
    <li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/code/" >Code</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/blog/" >Blog</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/about/" >About</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->
    <nav role="navigation" class="js-menu sliding-menu-content">
	<ul class="menu-item">
		<li>
      
        
      
			<a href="http://epijim.uk/my-papers/"><img src="http://epijim.uk/images/papers_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/my-papers/" class="title">Papers</a>
			<p class="excerpt">My published journal articles.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/code/"><img src="http://epijim.uk/images/code_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/code/" class="title">Code</a>
			<p class="excerpt">A collection of code snippets I think are really useful.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/blog/"><img src="http://epijim.uk/images/blog_thumb.jpg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/blog/" class="title">Blog</a>
			<p class="excerpt">My data based blog.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/about/"><img src="http://epijim.uk/images/about_thumb.jpeg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/about/" class="title">About</a>
			<p class="excerpt">Get more information on, or contact, James Black.</p>
		</li>
	</ul>
</nav>
<button type="button" class="js-menu-trigger sliding-menu-button menulines-button x2" role="button" aria-label="Toggle Navigation">
	<span class="menulines"></span>
</button>

<div class="js-menu-screen menu-screen"></div>

    <div id="page-wrapper">
      <!--[if lt IE 9]><div class="upgrade notice-danger"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

      <div id="main" role="main">	
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
			<div class="page-feature-header overlay">
			
			<div class="page-image">
				<img src="http://epijim.uk/images/pub_feature.jpg" class="page-feature-image" alt="Distance to the nearest pub" itemprop="image">
				
			</div><!-- /.page-image -->
			
			<div class="page-title">
        	<h1><span>Distance to the nearest pub</span></h1>
        	<div class="page-meta">
  
    <span>Filed under: <a href="/tag/r/" title="r" rel="tag">r</a>, <a href="/tag/geocoding/" title="geocoding" rel="tag">geocoding</a></span>
  
</div><!-- /.page-meta -->
			</div><!-- /.page-title -->
      	</div><!-- /.page-image-media -->
		<div class="inner-wrap">
			<nav class="toc"></nav><!-- /.toc -->
			<div id="content" class="page-content" itemprop="articleBody">
				<p>The plot below shows the distance to the nearest pub, from a grid of
 spots in Cambridge. Starting in the top left of the green box, I ran a script that calls 
 the <code>Google Distance Matrix API</code> to ask where the nearest pub is. It then moves a little to the right, 
 and asks again. When it hits the far side of the box, it drops down and 
 makes a new row of calls. Distances are coloured based on the time Google says it will take 
 to walk from that spot to the pub. I originally made this plot last year using Google’s data on Cambridge pubs, 
 but the data Google has is very inaccurate. The Food Standards Agency though has a daily 
 updated <a href="http://ratings.food.gov.uk/open-data/en-GB">XML file</a>, which has every pub nicely geo-coded. 
 This updated plot should be far more accurate.</p>

<h2 id="the-plot">The plot</h2>

<figure>
	<a href="/images/pub_1_timeto.jpg"><img src="/images/pub_1_timeto.jpg" /></a>
	<figcaption>Time to walk to the nearest pub from a grid of points in Cambridge. The black dots are the pubs.</figcaption>
</figure>

<h2 id="the-old-plot">The old plot</h2>

<p>Google only allows 2,500 calls to the distance API a day, and there are 1,600 points in my grid. This means
 it would take days to find out the walking distance to every pub. When I first made this plot 
 I simply went with the closest pub as the crow flies. When updating, I decided to look at the 
 walking distance to the two closest pubs. The plot below is using the method from my old post, 
 where I assumed the closest in a straight line was also the closest when walking.</p>

<figure>
	<a href="/images/pub_2_googledist.jpg"><img src="/images/pub_2_googledist.jpg" /></a>
	<figcaption>Using the method of my original plot, which doesn't account for the fact that the straight line difference isn't always the closest if you walk there.</figcaption>
</figure>

<h2 id="where-i-went-wrong">Where I went wrong</h2>

<p>While the difference between the two plots above are a little hard to make out, the plot below shows all the points in my
 grid where the shortest as the crow flies is not the shortest when walking. I made this post in one day, and only had 
 access to three API keys (I maxed out my own, Tina’s and the college IP address for day). 
 This meant I could only check the three closest pubs in a straight line. I’m fairly confident 
 the 316 (20%) points I found where the closest in a straight line, and walking, is different, covers all of the cases. The 
 only potential problem is that shortcuts through colleges and greens aren’t currently accounted for. 
 The plot below shows where the first post I made of distance to the nearest pub was wrong.</p>

<figure>
	<a href="/images/pub_3_closest.png"><img src="/images/pub_3_closest.png" /></a>
	<figcaption>The x's represent places where my original plot was wrong.</figcaption>
</figure>

<h2 id="pub-dense-areas">Pub dense areas</h2>

<p>The following plot simply shows where the nearest pub is.</p>

<figure>
	<a href="/images/pub_4_contour.jpg"><img src="/images/pub_4_contour.jpg" /></a>
	<figcaption>Where the pubs are clustered. As I also have their Food Safety ratings for the 3rd of October, 2014, I added that in as well.</figcaption>
</figure>

<h2 id="the-pubs">The pubs</h2>

<p>Finally, a google map of where all the pubs are.</p>

<iframe width="800" height="500" src="http://epijim.uk/iframecontent/pubgooglemap.html" frameborder="0" allowfullscreen=""></iframe>

<p>And a table of the name of the pub, and their food safety rating (as this data originally came from
 the FSA). The food safety data was based on what it was on the 3rd of October, 2014.</p>

<iframe width="800" height="500" src="http://epijim.uk/iframecontent/pubgoogletable.html" frameborder="0" allowfullscreen=""></iframe>

<h2 id="how-to">How to</h2>

<p>Nathan Yau wrote a brilliant book called Datapoints<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, where he introduces this style of
 map, and it is from there that based the code to handle the geo-coding. </p>

<p><strong>Below are links to some snippets I used to make this plot</strong></p>

<ul>
  <li><a href="http://epijim.uk/code/scrapexml/">Pull data</a> from the online XML file</li>
  <li><a href="http://epijim.uk/code/googleapi/">Feed data</a> to the <code>Google Distance Matrix API</code></li>
</ul>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Nathan Yau (<strong>2013</strong>) <em>Data Points: Visualization That Means Something</em>, ISBN: 978-1-118-46219-5 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<hr />
				<footer class="page-footer">
					


<div class="author-image">
	<img src="http://epijim.uk/images/bio-photo.jpg" alt="James Black">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <a href="http://epijim.uk" itemprop="author">James Black</a></h3>
	<p class="author-bio">Reading Epidemiology at Jesus College, University of Cambridge.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Distance%20to%20the%20nearest%20pub&amp;url=http://epijim.uk/blog/pub-distances/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://epijim.uk/blog/pub-distances/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=http://epijim.uk/blog/pub-distances/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->
					<div class="page-meta">
	<p>Updated <time datetime="2014-10-04T00:00:00Z" itemprop="datePublished">October 04, 2014</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<div class="entry-related">
					<h4>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h4>
					<ul>
						
						<li><a href="http://epijim.uk/code/googleapi/">Using Google API</a></li>
						
						<li><a href="http://epijim.uk/code/scrapexml/">Pulling an XML file off the internet</a></li>
						
						<li><a href="http://epijim.uk/blog/great-circles/">Facebook friend migrations</a></li>
						
						<li><a href="http://epijim.uk/code/wes-anderson/">Wes Anderson palettes for R</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<aside>
				<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'jamesblack';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		
	</article><!-- /.wrap -->
</div><!-- /#main -->



      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="http://epijim.uk/" >Home</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/about/" >About</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/terms/" >Legal</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2014 <a href="http://epijim.uk">James Black</a> hosted by <a href="https://pages.github.com">Github</a> and powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
<!-- google analytics -->	
<script> 
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'auto');
  ga('send', 'pageview');

</script>
</footer>
    </div>

    <script src="http://epijim.uk/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://epijim.uk/js/main.js"></script>
    
    
    <script type="text/javascript">
      $('.toc').toc({
        'selectors': 'h2', //elements to use as headings
        'container': '.page-content', //element to find all selectors in
        'smoothScrolling': true, //enable or disable smooth scrolling on click
        'prefix': 'toc', //prefix for anchor tags and class names
        'onHighlight': function(el) {}, //called when a new section is highlighted 
        'highlightOnScroll': true, //add class to heading that is currently in focus
        'highlightOffset': 100, //offset to trigger the next headline
        'anchorName': function(i, heading, prefix) { //custom function for anchor name
          return prefix+i;
        },
        'headerText': function(i, heading, $heading) { //custom function building the header-item text
          return $heading.text();
        },
        'itemClass': function(i, heading, $heading, prefix) { //custom function for item class
          return $heading[0].tagName.toLowerCase();
        }
      });
    </script>
    

  </body>

</html>
