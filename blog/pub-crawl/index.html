<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Optimum pub crawl route through all 71 Cambridge pubs • James Black</title>
    <meta name="description" content="Figuring out a solution to the 'travelling salesman problem' using R.">
    <meta name="keywords" content="r, map, cambridge">
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Optimum pub crawl route through all 71 Cambridge pubs">
	<meta name="twitter:description" content="Figuring out a solution to the 'travelling salesman problem' using R.">
	
	
	
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:image" content="http://epijim.uk/images/pub_feature.jpg">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Optimum pub crawl route through all 71 Cambridge pubs">
	<meta property="og:description" content="Figuring out a solution to the 'travelling salesman problem' using R.">
	<meta property="og:url" content="http://epijim.uk/blog/pub-crawl/">
	<meta property="og:site_name" content="James Black">
    <link rel="author" href="https://plus.google.com/https://plus.google.com/112022213613617220776/"/>

    <link rel="canonical" href="http://epijim.uk/blog/pub-crawl/">

    <link href="http://epijim.uk/atom.xml" type="application/atom+xml" rel="alternate" title="James Black Atom Feed">
    <link href="http://epijim.uk/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <style>
    .sliding-menu-content {
      top: 0;
      right: 0;
      text-align: center;
      visibility: hidden;
      height: 100%;
      width: 100%;
      -webkit-transform: translateX(100%);
      -moz-transform: translateX(100%);
      -ms-transform: translateX(100%);
      -o-transform: translateX(100%);
      transform: translateX(100%);
    }
    </style>

    <link rel="stylesheet" href="http://epijim.uk/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://epijim.uk/js/vendor/html5shiv.min.js"></script>
      <script src="http://epijim.uk/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <header id="masthead">
<link rel="alternate" type="application/rss+xml" title="James Black" href="http://epijim.uk/atom.xml">
  <div class="inner-wrap">
    <a href="http://epijim.uk" class="site-title">James Black</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">James Black</a></li>
	
    
        
    
    <li><a href="http://epijim.uk/about/" >About</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/code/" >Code</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/blog/" >Blog</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/courses/" >Courses</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

    <nav role="navigation" class="js-menu sliding-menu-content">
	<ul class="menu-item">
		<li>
      
        
      
			<a href="http://epijim.uk/about/"><img src="http://epijim.uk/images/about_thumb.jpeg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/about/" class="title">About</a>
			<p class="excerpt">Get more information on, or contact, James Black.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/my-papers/"><img src="http://epijim.uk/images/papers_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/my-papers/" class="title">Papers</a>
			<p class="excerpt">My published journal articles.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/code/"><img src="http://epijim.uk/images/code_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/code/" class="title">Code</a>
			<p class="excerpt">A collection of code snippets I think are really useful.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/blog/"><img src="http://epijim.uk/images/blog_thumb.jpg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/blog/" class="title">Blog</a>
			<p class="excerpt">My data based blog.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/courses/"><img src="http://epijim.uk/images/courses.jpg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/courses/" class="title">Courses</a>
			<p class="excerpt">Courses I've done relating to R or coding</p>
		</li>
	</ul>
</nav>
<button type="button" class="js-menu-trigger sliding-menu-button menulines-button x2" role="button" aria-label="Toggle Navigation">
	<span class="menulines"></span>
</button>

<div class="js-menu-screen menu-screen"></div>

    <div id="page-wrapper">
      <!--[if lt IE 9]><div class="upgrade notice-danger"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

      <div id="main" role="main">	
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
			<div class="page-feature-header overlay">
			
			<div class="page-image">
				<img src="http://epijim.uk/images/pub_feature.jpg" class="page-feature-image" alt="Optimum pub crawl route through all 71 Cambridge pubs" itemprop="image">
				
			</div><!-- /.page-image -->
			
			<div class="page-title">
        	<h1><span>Optimum pub crawl route through all 71 Cambridge pubs</span></h1>
        	<div class="page-meta">
  
    <span>Filed under: <a href="/tag/r/" title="r" rel="tag">r</a>, <a href="/tag/map/" title="map" rel="tag">map</a>, <a href="/tag/cambridge/" title="cambridge" rel="tag">cambridge</a></span>
  
</div><!-- /.page-meta -->
			</div><!-- /.page-title -->
      	</div><!-- /.page-image-media -->
		<div class="inner-wrap">
			<nav class="toc"></nav><!-- /.toc -->
			<div id="content" class="page-content" itemprop="articleBody">
				<script>
 (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.src = 'http://assets.gfycat.com/js/gfyajax-0.517d.js';
    s.parentNode.insertBefore(g, s);
}(document, 'script'));
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
  });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<p>There are 71 pubs in Cambridge, which makes plotting the shortest possible
 route is going to be difficult. If I wanted to start at home, and visit all
 71 pubs there would be $(72-1)! = 8.5\times 10^{101}$ potential pub crawl routes. That
 kind of problem is often called the Travelling Salesman Problem, which was a popular
 English parlour game in the 1800’s<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>. Pub crawls tend to
 be a straight route though, so I need to solve a <em>hamilton path</em> through the pubs.</p>

<p>While there is an <a href="http://cran.r-project.org/web/packages/TSP/">R package called TSP</a>
 devoted to solving these problems, I took a simplistic approach based off a
 Shiny app I hope to replicate at a later date.</p>

<h2 id="the-route">The route</h2>

<p>The plot below is a 30.3km route through all 71 pubs starting at the Wrestlers and ending at
 the Lord Bryon that was derived in about 40 seconds via simulated annealing.</p>

<figure>
	<a href="/images/crawl_1_route.png"><img src="/images/crawl_1_route.png" /></a>
	<figcaption>A 30.3km pub crawl route through all 71 Cambridge pubs.</figcaption>
</figure>

<h2 id="solving-the-problem">Solving the problem</h2>

<p>Simulated annealing is a technique inspired by annealing in metallurgy. In solving my pub crawl problem, the
 algorithm will initially be skewed toward picking longer routes, and as it continues to iterate
 it will slowly ‘cool’ and become more and more likely to choose a shorter route. This helps ensure the algorithm
 doesn’t get caught up in a local optimum route early. Sadly - just eyeballing - it appears
 the plot above is probably a local maximum. It looks like some travel time could be saved if
 the route visited the Mitre and Baron of Beef from the Pickerel, instead of it’s current
 diversion from the Brewhouse. I reran the model multiple times, and it usually found a route between 30 and 36km.</p>

<p>The gif below is another run, but it shows the map, the cooling curve, the distance travelled,
 and a histogram of all the distances recorded across the iterations as the model runs. This example also
 illustrates how the algorithm can fail. Here it’s pretty obvious that starting at the Lord Byron Inn
 and ending at the Tally Ho is not going to be the optimum route.</p>

<p><img class="gfyitem" data-id="SharpReflectingAntbear" /></p>

<h2 id="my-favourite-pubs">My favourite pubs</h2>

<p>The last gif is 5.6km route through my favourite pubs,</p>

<ol>
  <li>The Cambridge Brew House</li>
  <li>The Eagle Public House</li>
  <li>The Regal</li>
  <li>The Flying Pig</li>
  <li>The Cambridge Blue</li>
  <li>The Elm Tree</li>
  <li>Old Spring Public House</li>
  <li>King Street Run Public House</li>
</ol>

<p><img class="gfyitem" data-id="HarmoniousBlackIrrawaddydolphin" /></p>

<p>Once again, a quick visual inspection shows that some travel time could be saved with minor
 tweaks to the last graph. While I still have long term plans to make a Cambridge interactive
 pub crawl app via R (and shiny), for now the following XKCD plot sums up what this has taught me -
 I just found a really complicated way to plot a pub crawl route which can be easily beaten
 by a person, as long as you’re planning on visiting less than 20ish pubs.</p>

<figure>
	<a href="/images/crawl_2_xkcd.png"><img src="/images/crawl_2_xkcd.png" /></a>
	<figcaption>An XKCD cartoon on the Travelling Salesman Problem.</figcaption>
</figure>

<h2 id="my-function">My function</h2>

<p>I wrapped up the code<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> in a function, which can be called from github.</p>

<h3 id="load-the-function">Load the function</h3>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-r" data-lang="r">1
2
3</code></pre></div></td><td class="code"><div class="highlight"><pre>install.packages<span class="p">(</span><span class="s">&#39;devtools&#39;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span><span class="s">&#39;devtools&#39;</span><span class="p">)</span>
source_gist<span class="p">(</span><span class="s">&quot;https://gist.github.com/epijim/8f4be4dae598e479add0&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p><code>ggmap</code> is required to run this function.</p>

<h3 id="input-variables">Input variables</h3>

<p><code>v_pubs</code> - either a list of pubs <code>c(pub1,pub2)</code> or a dataset with the latitude in
 the first column and the longitude in the second. If feeding in a dataset, you also
 need to set <code>cam_pubs=FALSE</code>.</p>

<p><code>crow_distances</code> - defaults to <code>FALSE</code>. If set to <code>FALSE</code>, and <code>cam_pubs=TRUE</code> (the default),
 the function will calculate the best route using Google maps based distance or time to walk. If
 <code>crow_distances=TRUE</code>, the function will use straight line distances (taking into
   account the Earth’s curvature). If <code>cam_pubs=FALSE</code>,
 the function will always use straight line (<em>as the crow flies</em> data).</p>

<p><code>units</code> - Defaults to <code>"minutes"</code>, which makes the function calculate the route based on
 the Google maps derived walking time. Can also be set to <code>"metres"</code>, which will make the
 function use and report the distance of the crawl in metres based on Google maps directions.
 This option is only evaluated if <code>crow_distances=FALSE</code> and you are using the
 inbuilt pub data.</p>

<p><code>v_location</code> - defaults to <code>"Cambridge, UK"</code>. This value is given to <code>ggmap</code> when pulling
 the base map. Only really needed if feeding in a different dataset. If using a different
 basemap, <code>v_zoom</code> will allow the zoom on the base map to be set.</p>

<p><code>listpubs</code> - defaults to <code>FALSE</code>. If set to <code>TRUE</code> the function will print the list of pubs
 and then exit the function (ignoring all other options and not running the model). I
 added this as the pub names need to be entered in perfectly into <code>v_pubs</code> for it to
 work.</p>

<h3 id="use">Use</h3>

<p>The function, when loaded, will pull data from another gist which has the pubs in it.
 You can see the names of the pubs by typing <code>jb_pubdistance(listpubs=T)</code>.</p>

<p>A typical call to the function would be:</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-r" data-lang="r">1
2</code></pre></div></td><td class="code"><div class="highlight"><pre>results <span class="o">&lt;-</span> jb_pubdistance<span class="p">(</span>v_pubs<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;The Maypole P.H.&quot;</span><span class="p">,</span><span class="s">&quot;The Eagle Public House&quot;</span><span class="p">,</span>
                                   <span class="s">&quot;Pickerel Inn&quot;</span><span class="p">,</span><span class="s">&quot;Baron Of Beef&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>In the example above, we will get the default format for the results, which is based on
 what google claims is the default walking time. See <em>Input variables</em> above on how to
 feed in custom data, or get back the distance in metres in actual walking routes, or as
 the crow flies.</p>

<p>So by setting <code>&lt;-</code>, we created an object called <code>results</code>. The following
 results are stored.</p>

<ul>
  <li><code>results$distance</code> - the distance of the pub crawl</li>
  <li><code>results$pubs_inorder</code> - the pubs in order. If using my pubs data, it will give some info on the pubs. If feeding in custom lats and lons, it will be the original dataset in trip order.</li>
  <li><code>results$temperature</code> - the temperature values used over the iterations</li>
</ul>

<p>The function will also return a plot showing the route.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>The <a href="http://en.wikipedia.org/wiki/Icosian_game">Icosian game</a> was a peg based game invented in 1857. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>This function just gives the final route, not the gifs of how the model was fit. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<hr />
				<footer class="page-footer">
					


<div class="author-image">
	<img src="http://epijim.uk/images/bio-photo.jpg" alt="James Black">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <a href="http://epijim.uk" itemprop="author">James Black</a></h3>
	<p class="author-bio">Reading Epidemiology at Jesus College, University of Cambridge.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Optimum%20pub%20crawl%20route%20through%20all%2071%20Cambridge%20pubs&amp;url=http://epijim.uk/blog/pub-crawl/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://epijim.uk/blog/pub-crawl/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=http://epijim.uk/blog/pub-crawl/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->
					<div class="page-meta">
	<p>Updated <time datetime="2014-10-05T00:00:00Z" itemprop="datePublished">October 05, 2014</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<div class="entry-related">
					<h4>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h4>
					<ul>
						
						<li><a href="http://epijim.uk/blog/when-cam-nice-app/">When is it nice in Cambridge (interactive app)?</a></li>
						
						<li><a href="http://epijim.uk/blog/when-cam-nice/">When is it nice in Cambridge?</a></li>
						
						<li><a href="http://epijim.uk/blog/pub-distances/">Distance to the nearest pub</a></li>
						
						<li><a href="http://epijim.uk/code/googleapi/">Using Google API</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<aside>
				<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'jamesblack';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		<div class="ads"><style>
.responsive-ads { width: 300px; height: 200px; }
@media(min-width: 520px) { .responsive-ads { width: 468px; height: 60px; } }
@media(min-width: 768px) { .responsive-ads { width: 160px; height: 600px; } }
</style>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle responsive-ads"
	style="display:inline-block"
	data-ad-client="ca-pub-8433594162604860"
	data-ad-slot="9138304032"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div><!-- /.ads -->
	</article><!-- /.wrap -->
</div><!-- /#main -->



      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="http://epijim.uk/" >Home</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/about/" >About</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/terms/" >Legal</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2014 <a href="http://epijim.uk">James Black</a> hosted by <a href="https://pages.github.com">Github</a> and powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
<!-- google analytics -->	
<script> 
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'auto');
  ga('send', 'pageview');

</script>
</footer>
    </div>

    <script src="http://epijim.uk/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://epijim.uk/js/main.js"></script>
    
    
    <script type="text/javascript">
      $('.toc').toc({
        'selectors': 'h2', //elements to use as headings
        'container': '.page-content', //element to find all selectors in
        'smoothScrolling': true, //enable or disable smooth scrolling on click
        'prefix': 'toc', //prefix for anchor tags and class names
        'onHighlight': function(el) {}, //called when a new section is highlighted 
        'highlightOnScroll': true, //add class to heading that is currently in focus
        'highlightOffset': 100, //offset to trigger the next headline
        'anchorName': function(i, heading, prefix) { //custom function for anchor name
          return prefix+i;
        },
        'headerText': function(i, heading, $heading) { //custom function building the header-item text
          return $heading.text();
        },
        'itemClass': function(i, heading, $heading, prefix) { //custom function for item class
          return $heading[0].tagName.toLowerCase();
        }
      });
    </script>
    

  </body>

</html>
