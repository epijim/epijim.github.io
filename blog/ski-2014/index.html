<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Plotting data from the ski tracks app in R • James Black</title>
    <meta name="description" content="Plotting data from the ski tracks app using R, from a recent trip to Pitztal Glacier.">
    <meta name="keywords" content="R, Skiing, Map, GPS">
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Plotting data from the ski tracks app in R">
	<meta name="twitter:description" content="Plotting data from the ski tracks app using R, from a recent trip to Pitztal Glacier.">
	
	
	
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:image" content="http://epijim.uk/images/ski_feature.jpeg">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Plotting data from the ski tracks app in R">
	<meta property="og:description" content="Plotting data from the ski tracks app using R, from a recent trip to Pitztal Glacier.">
	<meta property="og:url" content="http://epijim.uk/blog/ski-2014/">
	<meta property="og:site_name" content="James Black">
    <link rel="author" href="https://plus.google.com/https://plus.google.com/112022213613617220776/"/>

    <link rel="canonical" href="http://epijim.uk/blog/ski-2014/">

    <link href="http://epijim.uk/atom.xml" type="application/atom+xml" rel="alternate" title="James Black Atom Feed">
    <link href="http://epijim.uk/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <style>
    .sliding-menu-content {
      top: 0;
      right: 0;
      text-align: center;
      visibility: hidden;
      height: 100%;
      width: 100%;
      -webkit-transform: translateX(100%);
      -moz-transform: translateX(100%);
      -ms-transform: translateX(100%);
      -o-transform: translateX(100%);
      transform: translateX(100%);
    }
    </style>

    <link rel="stylesheet" href="http://epijim.uk/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://epijim.uk/js/vendor/html5shiv.min.js"></script>
      <script src="http://epijim.uk/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <header id="masthead">
  <div class="inner-wrap">
    <a href="http://epijim.uk" class="site-title">James Black</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">James Black</a></li>
	
    
        
    
    <li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/code/" >Code</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/blog/" >Blog</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/about/" >About</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->
    <nav role="navigation" class="js-menu sliding-menu-content">
	<ul class="menu-item">
		<li>
      
        
      
			<a href="http://epijim.uk/my-papers/"><img src="http://epijim.uk/images/papers_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/my-papers/" class="title">Papers</a>
			<p class="excerpt">My published journal articles.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/code/"><img src="http://epijim.uk/images/code_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/code/" class="title">Code</a>
			<p class="excerpt">A collection of code snippets I think are really useful.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/blog/"><img src="http://epijim.uk/images/blog_thumb.jpg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/blog/" class="title">Blog</a>
			<p class="excerpt">My data based blog.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/about/"><img src="http://epijim.uk/images/about_thumb.jpeg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/about/" class="title">About</a>
			<p class="excerpt">Get more information on, or contact, James Black.</p>
		</li>
	</ul>
</nav>
<button type="button" class="js-menu-trigger sliding-menu-button menulines-button x2" role="button" aria-label="Toggle Navigation">
	<span class="menulines"></span>
</button>

<div class="js-menu-screen menu-screen"></div>

    <div id="page-wrapper">
      <!--[if lt IE 9]><div class="upgrade notice-danger"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

      <div id="main" role="main">	
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
		
		<div class="page-feature">
			<div class="page-image">
				<img src="http://epijim.uk/images/ski_feature.jpeg" class="page-feature-image" alt="Plotting data from the ski tracks app in R" itemprop="image">
				<div class="image-credit">Image source: <a href="" itemprop="citation">Part of Pitzal ski field</a></div><!-- /.image-credit -->
			</div><!-- /.page-image -->
		</div><!-- /.page-feature -->
		
		<nav class="breadcrumbs">
  <a href="http://epijim.uk">Home</a> <span class="divider">/</span> <a href="http://epijim.uk/blog/">Blog</a> <span class="divider">/</span>
</nav><!-- /.breadcrumbs -->
		<div class="page-title">
			<h1>Plotting data from the ski tracks app in R</h1>
		</div>
		<div class="inner-wrap">
			<nav class="toc"></nav><!-- /.toc -->
			<div id="content" class="page-content" itemprop="articleBody">
				<p>A week ago Tina and I went skiing at an Austrian resort called Pitztal. While it’s a pretty small
 ski field by European standards<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, Pitztal sits on the highest glacier in 
 Tyrol, and has incredible snow. Below is a map. We mainly skied on the Pitztal Glacier, and only really went across 
 to Rifflsee for the last few runs of the day. </p>

<figure>
	<a href="/images/ski_1_pitztal.jpg"><img src="/images/ski_1_pitztal.jpg" /></a>
	<figcaption>Map of the Pitztal Glacier ski field.</figcaption>
</figure>

<p>While there I used an
 app called <a href="https://itunes.apple.com/gb/app/ski-tracks-gps-track-recorder/id365724094?mt=8">Ski Tracks</a> 
 to record where, when and how fast I skied.</p>

<p>The app actually makes really great graphics, and if you’re not an R fanatic there really isn’t
 a need to pull out the data and re-plot it yourself. Below are some example screens 
 from within the app.</p>

<figure>
	<a href="/images/ski_0_skitracksapp.jpeg"><img src="/images/ski_0_skitracksapp.jpeg" /></a>
	<figcaption>Five example screens from the app.</figcaption>
</figure>

<h2 id="get-the-data-into-r">Get the data into R</h2>

<p>I like the freedom to do what ever I want with the data though, so I pulled it into R.
 There are ready made functions out there to read a gpx file into a data frame<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>, or you 
 can use an online service to convert it to a csv.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p>

<h2 id="define-run-direction">Define run direction</h2>

<p>As you ski down the hill, and ride a gondola up it, it should be easy to code if you are
 actually skiing.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># code if going up or down!</span>
  updown <span class="o">&lt;-</span> <span class="kp">sapply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>routes
                                 <span class="p">),</span>
                          <span class="kr">function</span><span class="p">(</span>i<span class="p">)</span> <span class="p">(</span>
                            <span class="kp">ifelse</span><span class="p">((</span>routes<span class="p">[</span>i<span class="p">,</span><span class="s">&quot;elevation&quot;</span><span class="p">]</span> <span class="o">-</span> routes<span class="p">[</span>i<span class="m">-1</span><span class="p">,</span><span class="s">&quot;elevation&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,</span><span class="s">&quot;Up&quot;</span><span class="p">,</span><span class="s">&quot;Down&quot;</span><span class="p">)))</span></code></pre></div>

<p>Unfortunately you do go up and down during a run, so I had to do some manual edits after.</p>

<h2 id="day-one-skiing">Day one skiing</h2>

<p>Below is day one of skiing. The code for this plot <a href="http://www.epijim.co.uk/articles/pathsinr/">is here</a>.</p>

<figure class="half">
	<img src="/images/ski_1_sat.jpeg" />
	<img src="/images/ski_2_ter.jpeg" />
	<figcaption>Our first day skiing. On the left the basemap is a satellite photo, on the right it's a terrain map. Lifts are in red, runs in blue.</figcaption>
</figure>

<h2 id="day-one-two-and-three-skiing">Day one, two and three skiing</h2>

<p>At Pitztal, you take an underground train from the village up to the glacier. On the second day 
 we found out it is possible to ski down from the Glacier, all the way through the town, 
 to the gondola that goes up to the other part of the ski field called Rifflsee. This was 
 my favourite run on the mountain, as the one run was a vertical drop from 3,440m to 1,674m.<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup> Meaning you start 
 a couple of hundred metres below the height of Mt Cook (NZ’s biggest mountain), and ski a vertical 
 distance that’s bigger than the distance between the top of Coronet Peak ski field, and sea level.</p>

<p>The best bit of the run that goes between the ski areas was you have to ski through the gate
 below at the start of the trail.</p>

<figure>
	<a href="/images/ski_gif.gif"><img src="/images/ski_gif.gif" /></a>
</figure>

<p>The photo’s below show day one and three overlaid. The blue line linking the two ski fields
 is the epic run mentioned above. </p>

<figure class="half">
	<img src="/images/ski_4a_1n2_ter.jpeg" />
	<img src="/images/ski_4b_1n2_sat.jpeg" />
	<figcaption>First and third day skiing on the same plots. Day one is a lighter blue.</figcaption>
</figure>

<p>According to <em>Ski Tracks</em>, my top speed was over 110 km/hr. Looking at the raw data, there was one
 part of the run where I was at mid-80’s, before suddenly it jumped up 20 km/hr for 3 data points (<em>which was about a second</em>). 
 This is just phone GPS data, and probably full of errors, so I manually subtracted the bonus 20 from those three data points.</p>

<p>In general the <em>Ski Tracks</em> app seems to do some sneaky smoothing when it plots the data in-app.
 The raw data seems to have bigger variations. For one sequence of three data points, my phone claims I went 
 from 76 km/hr to 85 km/hr to 71 km/hr. In just under a second. Because of this, coupled with the implausible 120 km/hr 
 speed burst, I decided I should chuck a rolling average over my speed data.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">map_data_2_trunc <span class="o">&lt;-</span> map_data_2<span class="p">[</span>
  map_data_2<span class="o">$</span>index <span class="o">%in%</span> <span class="kp">names</span><span class="p">(</span><span class="kp">which</span><span class="p">(</span><span class="kp">table</span><span class="p">(</span>map_data_2<span class="o">$</span>index<span class="p">)</span> <span class="o">&gt;</span> <span class="m">10</span><span class="p">)),</span> 
  <span class="p">]</span> <span class="c1"># make a subset of data with just runs over 10 data points (i.e. at least a minute long).</span>

<span class="kn">library</span><span class="p">(</span>zoo<span class="p">)</span> <span class="c1"># zoo has the rollmean function</span>
index <span class="o">&lt;-</span> <span class="kp">unique</span><span class="p">(</span>map_data_2_trunc<span class="o">$</span>index<span class="p">)</span> <span class="c1"># only do rolling average within a run</span>
<span class="kr">for</span><span class="p">(</span>i <span class="kr">in</span> index<span class="p">){</span>
  map_data_2_trunc<span class="p">[</span> 
    <span class="kp">which</span><span class="p">(</span>map_data_2_trunc<span class="o">$</span>index<span class="o">==</span>i<span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;speed_roll&quot;</span><span class="p">)</span>
    <span class="p">]</span> <span class="o">&lt;-</span> rollmean<span class="p">(</span>map_data_2_trunc<span class="p">[</span> 
    <span class="kp">which</span><span class="p">(</span>map_data_2_trunc<span class="o">$</span>index<span class="o">==</span>i<span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;speed&quot;</span><span class="p">)</span>
    <span class="p">],</span><span class="m">5</span><span class="p">,</span> fill<span class="o">=</span><span class="kc">NA</span><span class="p">)</span> <span class="c1"># Average over 5 points. Note, as at the start of a run you cant</span>
    <span class="c1">#				 have a rolling average, so some data points are lost, </span>
    <span class="c1">#                and become NA.</span>
<span class="p">}</span></code></pre></div>

<p>Now plotting the runs, colouring by the rolling average speed.</p>

<figure>
	<a href="/images/ski_5_time.png"><img src="/images/ski_5_time.png" /></a>
	<figcaption>Start and end altitudes of runs on the second day.</figcaption>
</figure>

<p>The data seemed to be the most unreliable for a handful of the runs. In the next dotplot I
 tightened up the code to drop any runs with less than 100 data points, and increased the rolling 
 average to to cover about a 30 seconds of data. I liked how the bits of the run where I 
 usually slow down start to show up.</p>

<p>Code for the dotplot is <a href="http://epijim.co.uk/articles/dotplot/">here</a>.</p>

<figure>
	<a href="/images/ski_6_runs.jpeg"><img src="/images/ski_6_runs.jpeg" /></a>
	<figcaption>A dotplot of rolling average speed accross a selected sub sample of runs on the second day.</figcaption>
</figure>

<p>Finally, a 3D scatter plot of the runs from day two. The 3D scatter plot is super simple to make: 
code <a href="http://epijim.co.uk/articles/3Dscatter/">is here</a>.</p>

<figure>
	<a href="/images/ski_scattergif.gif"><img src="/images/ski_scattergif.gif" /></a>
</figure>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Pitztal has 40.6 km of runs accross Rifflsee and the Glacier. Arlberg, Kaprun, SkiWelt and Ischgil are all Austrian ski fields with more than 220km of piste. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><a href="http://plotkml.r-forge.r-project.org/readGPX.html">readGPX</a> is an example from CRAN. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>An example of a free service is <a href="http://www.gpsvisualizer.com/convert_input">GPS visualiser</a> <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>If you started at the top of the highest gondola at Pitztal. <a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<hr />
				<footer class="page-footer">
					


<div class="author-image">
	<img src="http://epijim.uk/images/bio-photo.jpg" alt="James Black">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <a href="http://epijim.uk" itemprop="author">James Black</a></h3>
	<p class="author-bio">Reading Epidemiology at Jesus College, University of Cambridge.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Plotting%20data%20from%20the%20ski%20tracks%20app%20in%20R&amp;url=http://epijim.uk/blog/ski-2014/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://epijim.uk/blog/ski-2014/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=http://epijim.uk/blog/ski-2014/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->
					<div class="page-meta">
	<p>Updated <time datetime="2014-03-09T00:00:00Z" itemprop="datePublished">March 09, 2014</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<div class="entry-related">
					<h4>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h4>
					<ul>
						
						<li><a href="http://epijim.uk/code/wes-anderson/">Wes Anderson palettes for R</a></li>
						
						<li><a href="http://epijim.uk/code/xkcd/">XKCD style graphs in R</a></li>
						
						<li><a href="http://epijim.uk/blog/independence/">Scottish independence polls</a></li>
						
						<li><a href="http://epijim.uk/blog/worldcup14/">Changing fate of the German football team</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<aside>
				<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'jamesblack';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		
	</article><!-- /.wrap -->
</div><!-- /#main -->



      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="http://epijim.uk/" >Home</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/about/" >About</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/terms/" >Legal</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2014 <a href="http://epijim.uk">James Black</a> hosted by <a href="https://pages.github.com">Github</a> and powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
<!-- google analytics -->	
<script> 
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'auto');
  ga('send', 'pageview');

</script>
</footer>
    </div>

    <script src="http://epijim.uk/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://epijim.uk/js/main.js"></script>
    
    
    <script type="text/javascript">
      $('.toc').toc({
        'selectors': 'h2', //elements to use as headings
        'container': '.page-content', //element to find all selectors in
        'smoothScrolling': true, //enable or disable smooth scrolling on click
        'prefix': 'toc', //prefix for anchor tags and class names
        'onHighlight': function(el) {}, //called when a new section is highlighted 
        'highlightOnScroll': true, //add class to heading that is currently in focus
        'highlightOffset': 100, //offset to trigger the next headline
        'anchorName': function(i, heading, prefix) { //custom function for anchor name
          return prefix+i;
        },
        'headerText': function(i, heading, $heading) { //custom function building the header-item text
          return $heading.text();
        },
        'itemClass': function(i, heading, $heading, prefix) { //custom function for item class
          return $heading[0].tagName.toLowerCase();
        }
      });
    </script>
    

  </body>

</html>
