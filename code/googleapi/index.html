<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Using Google API • James Black</title>
    <meta name="description" content="Getting distance data using Google API">
    <meta name="keywords" content="r, api, google">
    
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Using Google API">
	<meta name="twitter:description" content="Getting distance data using Google API">
	
	
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="http://epijim.uk/images/120x120.gif">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Using Google API">
	<meta property="og:description" content="Getting distance data using Google API">
	<meta property="og:url" content="http://epijim.uk/code/googleapi/">
	<meta property="og:site_name" content="James Black">
    <link rel="author" href="https://plus.google.com/https://plus.google.com/112022213613617220776/"/>

    <link rel="canonical" href="http://epijim.uk/code/googleapi/">

    <link href="http://epijim.uk/atom.xml" type="application/atom+xml" rel="alternate" title="James Black Atom Feed">
    <link href="http://epijim.uk/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <style>
    .sliding-menu-content {
      top: 0;
      right: 0;
      text-align: center;
      visibility: hidden;
      height: 100%;
      width: 100%;
      -webkit-transform: translateX(100%);
      -moz-transform: translateX(100%);
      -ms-transform: translateX(100%);
      -o-transform: translateX(100%);
      transform: translateX(100%);
    }
    </style>

    <link rel="stylesheet" href="http://epijim.uk/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://epijim.uk/js/vendor/html5shiv.min.js"></script>
      <script src="http://epijim.uk/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body>
    <header id="masthead">
<link rel="alternate" type="application/rss+xml" title="James Black" href="http://epijim.uk/atom.xml">
  <div class="inner-wrap">
    <a href="http://epijim.uk" class="site-title">James Black</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">James Black</a></li>
	
    
        
    
    <li><a href="http://epijim.uk/about/" >About</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/code/" >Code</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/blog/" >Blog</a></li>
  
    
        
    
    <li><a href="http://epijim.uk/courses/" >Courses</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

    <nav role="navigation" class="js-menu sliding-menu-content">
	<ul class="menu-item">
		<li>
      
        
      
			<a href="http://epijim.uk/about/"><img src="http://epijim.uk/images/about_thumb.jpeg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/about/" class="title">About</a>
			<p class="excerpt">Get more information on, or contact, James Black.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/my-papers/"><img src="http://epijim.uk/images/papers_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/my-papers/" class="title">Papers</a>
			<p class="excerpt">My published journal articles.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/code/"><img src="http://epijim.uk/images/code_thumb.png" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/code/" class="title">Code</a>
			<p class="excerpt">A collection of code snippets I think are really useful.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/blog/"><img src="http://epijim.uk/images/blog_thumb.jpg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/blog/" class="title">Blog</a>
			<p class="excerpt">My data based blog.</p>
		</li><li>
      
        
      
			<a href="http://epijim.uk/courses/"><img src="http://epijim.uk/images/courses.jpg" alt="teaser" class="teaser"></a>
			<a href="http://epijim.uk/courses/" class="title">Courses</a>
			<p class="excerpt">Courses I've done relating to R or coding</p>
		</li>
	</ul>
</nav>
<button type="button" class="js-menu-trigger sliding-menu-button menulines-button x2" role="button" aria-label="Toggle Navigation">
	<span class="menulines"></span>
</button>

<div class="js-menu-screen menu-screen"></div>

    <div id="page-wrapper">
      <!--[if lt IE 9]><div class="upgrade notice-danger"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

      <div id="main" role="main">			
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
		
		<nav class="breadcrumbs">
  <a href="http://epijim.uk">Home</a> <span class="divider">/</span> <a href="http://epijim.uk/code/">Code</a> <span class="divider">/</span>
</nav><!-- /.breadcrumbs -->
		<div class="page-title">
			<h1>Using Google API</h1>
		</div>
		<div class="inner-wrap">
			<nav class="toc"></nav><!-- /.toc -->
			<div id="content" class="page-content" itemprop="articleBody">
				<p>The following is the function I used to make my blog post on the distance to the nearest pub.
 This function was used to get the walking distance and time from a point I specified, to the
 nearest pub.</p>

<h2 id="getting-an-api-key">Getting an API key</h2>

<p>You don’t always need an API key, as google will often allow requests based on your IP,
 but getting a key often means you are allowed to make more calls. Plus my current IP at
 Cambridge University seems to be responsible for a lot of keyless API requests, so it’s
 often maxed out.</p>

<p>The <a href="https://console.developers.google.com">Google API console is here</a>. Simply set up a project,
 then create a browser key. You can limit requests to your own IP address to prevent someone
 else using it (say if you accidentally share the key), or leave that field blank and let
 anyone with the key use it.</p>

<h2 id="the-available-apis-at-google">The available APIs at google</h2>

<p>There are heaps of APIs out there, but I’m focusing on Google’s as they are really well
 documented. The list of APIs available from Google is <a href="https://developers.google.com/apis-explorer/">here</a>.
 The one I want is the <code>Google Distance Matrix API</code><sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, which is part of the maps API.</p>

<h2 id="the-function">The function</h2>

<p>Function to take the latitude and longitude of two points, actually make the call,
 and spit out an object with the distance and time. The function has four inputs.</p>

<p><code>origin</code> and <code>destination</code> is the latitude and longitude in the format <code>"latitude,longitude"</code>. It can also take
 text like <code>"Jesus College, Cambridge, UK"</code>.</p>

<p><code>mode</code> is what mode of travel you want. The options are <code>"driving"</code>, <code>"walking"</code> and <code>"bicycling"</code>.</p>

<p><code>key</code> is your API key.</p>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="language-r" data-lang="r"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</code></pre></div></td><td class="code"><div class="highlight"><pre>latlon2ft <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>origin<span class="p">,</span>destination<span class="p">,</span><span class="kp">mode</span><span class="p">,</span>key<span class="p">){</span>
    xml.url <span class="o">&lt;-</span> <span class="kp">paste0</span><span class="p">(</span>
      <span class="s">&#39;https://maps.googleapis.com/maps/api/distancematrix/xml?origins=&#39;</span><span class="p">,</span>
      origin<span class="p">,</span><span class="s">&#39;&amp;destinations=&#39;</span><span class="p">,</span>
      destination<span class="p">,</span>
      <span class="s">&#39;&amp;mode=&#39;</span><span class="p">,</span>
      <span class="kp">mode</span><span class="p">,</span><span class="s">&#39;</span>
<span class="s">      &amp;key=&#39;</span><span class="p">,</span>
      key<span class="p">,</span>
      <span class="s">&#39;&amp;sensor=false&#39;</span><span class="p">)</span>
    xmlfile <span class="o">&lt;-</span> xmlParse<span class="p">(</span>getURL<span class="p">(</span>xml.url<span class="p">))</span>
    time <span class="o">&lt;-</span> xmlValue<span class="p">(</span>xmlChildren<span class="p">(</span>xpathApply<span class="p">(</span>xmlfile<span class="p">,</span><span class="s">&quot;//duration&quot;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]])</span><span class="o">$</span>value<span class="p">)</span>
    time <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span><span class="kp">as.numeric</span><span class="p">(</span>time<span class="p">)</span><span class="o">/</span><span class="m">60</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
    dist <span class="o">&lt;-</span> xmlValue<span class="p">(</span>xmlChildren<span class="p">(</span>xpathApply<span class="p">(</span>xmlfile<span class="p">,</span><span class="s">&quot;//distance&quot;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]])</span><span class="o">$</span>value<span class="p">)</span>
    distance <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">sub</span><span class="p">(</span><span class="s">&quot; km&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span>dist<span class="p">))</span>
    output <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>time<span class="p">,</span>distance<span class="p">)</span>
    <span class="kr">return</span><span class="p">(</span>output<span class="p">)</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="https://developers.google.com/maps/documentation/distancematrix/">Documentation</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<hr />
				<footer class="page-footer">
					


<div class="author-image">
	<img src="http://epijim.uk/images/bio-photo.jpg" alt="James Black">
</div><!-- ./author-image -->
<div class="author-content">
	<h3 class="author-name" >Written by <a href="http://epijim.uk" itemprop="author">James Black</a></h3>
	<p class="author-bio">Reading Epidemiology at Jesus College, University of Cambridge.</p>
</div><!-- ./author-content -->
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Using%20Google%20API&amp;url=http://epijim.uk/code/googleapi/&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://epijim.uk/code/googleapi/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social google-plus"  href="https://plus.google.com/share?url=http://epijim.uk/code/googleapi/" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i> Share on Google+</a>
</div><!-- /.share-this -->
					<div class="page-meta">
	<p>Updated <time datetime="2014-10-04T00:00:00Z" itemprop="datePublished">October 04, 2014</time></p>
</div><!-- /.page-meta -->
					<div class="page-meta">
  
    <span>Filed under: <a href="/tag/r/" title="r" rel="tag">r</a>, <a href="/tag/api/" title="api" rel="tag">api</a>, <a href="/tag/google/" title="google" rel="tag">google</a></span>
  
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<aside>
					<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'jamesblack';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		<div class="ads"><style>
.responsive-ads { width: 300px; height: 200px; }
@media(min-width: 520px) { .responsive-ads { width: 468px; height: 60px; } }
@media(min-width: 768px) { .responsive-ads { width: 160px; height: 600px; } }
</style>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle responsive-ads"
	style="display:inline-block"
	data-ad-client="ca-pub-8433594162604860"
	data-ad-slot="9138304032"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div><!-- /.ads -->
	</article><!-- ./wrap -->
</div><!-- /#main -->

      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="http://epijim.uk/" >Home</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/my-papers/" >Papers</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/about/" >About</a></li>
		
      
        
      
			<li><a href="http://epijim.uk/terms/" >Legal</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2014 <a href="http://epijim.uk">James Black</a> hosted by <a href="https://pages.github.com">Github</a> and powered by <a href="http://jekyllrb.com">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/">Skinny Bones</a>.</p>
<!-- google analytics -->	
<script> 
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'auto');
  ga('send', 'pageview');

</script>
</footer>
    </div>

    <script src="http://epijim.uk/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://epijim.uk/js/main.js"></script>
    
    
    <script type="text/javascript">
      $('.toc').toc({
        'selectors': 'h2', //elements to use as headings
        'container': '.page-content', //element to find all selectors in
        'smoothScrolling': true, //enable or disable smooth scrolling on click
        'prefix': 'toc', //prefix for anchor tags and class names
        'onHighlight': function(el) {}, //called when a new section is highlighted 
        'highlightOnScroll': true, //add class to heading that is currently in focus
        'highlightOffset': 100, //offset to trigger the next headline
        'anchorName': function(i, heading, prefix) { //custom function for anchor name
          return prefix+i;
        },
        'headerText': function(i, heading, $heading) { //custom function building the header-item text
          return $heading.text();
        },
        'itemClass': function(i, heading, $heading, prefix) { //custom function for item class
          return $heading[0].tagName.toLowerCase();
        }
      });
    </script>
    

  </body>

</html>
