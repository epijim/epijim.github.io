<!doctype html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7 no-js" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="lt-ie9 lt-ie8 no-js" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="lt-ie9 no-js" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"><!--<![endif]-->

<head>
	<meta charset="utf-8">
	<title>Contour mapping Cambridge crime &#8211; James Black</title>
	<meta name="description" content="Plotting Cambridge crime data on a map using R.">
	<meta name="keywords" content="R, Map, Cambridge">
	<!-- Twitter Cards -->
	
		<meta name="twitter:card" content="summary">
			<meta name="twitter:image" content="http://epijim.co.uk/images/crimes_thumb.png">
		
	
	<meta name="twitter:title" content="Contour mapping Cambridge crime">
	<meta name="twitter:description" content="Plotting Cambridge crime data on a map using R.">
	<meta name="twitter:site" content="@">
	<meta name="twitter:creator" content="@">
	
<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Contour mapping Cambridge crime">
<meta property="og:description" content="Plotting Cambridge crime data on a map using R.">
<meta property="og:url" content="http://epijim.co.uk/articles/crime-cambridge/">
<meta property="og:site_name" content="James Black">

	<!-- Webmaster Tools verifications -->
	
	

	
	<link rel="canonical" href="http://epijim.co.uk/articles/crime-cambridge/">
	<link href="http://feeds.feedburner.com/epijim" type="application/atom+xml" rel="alternate" title="James Black &#8211; Everything Feed">
	<link rel="author" href="https://plus.google.com/112022213613617220776/?rel=author">

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta http-equiv="cleartype" content="on">

	<!-- For all browsers -->
	<link rel="stylesheet" href="http://epijim.co.uk/css/main.min-92de9747e44e9254411a46b258723e1d.css">

	<!-- Web fonts -->
	<script src="//use.edgefonts.net/lato:n3,i3,n4,i4,n7.js"></script>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">

	<!-- HTML5 Shiv and Media Query Support -->
	<!--[if lt IE 9]>
		<script src="http://epijim.co.uk/js/vendor/html5shiv-5a98a86b5cb48c1506f338463259ce41.js"></script>
		<script src="http://epijim.co.uk/js/vendor/respond-e5d7fffb3a9f891c926ee1b836d448d8.js"></script>
	<![endif]-->

	<!-- Icons -->
	<!-- 16x16 -->
	<link rel="shortcut icon" href="http://epijim.co.uk/favicon.ico">
	<!-- 32x32 -->
	<link rel="shortcut icon" href="http://epijim.co.uk/favicon.png">
	<!-- non-retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon57.png" sizes="57x57">
	<!-- non-retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon72.png" sizes="72x72">
	<!-- non-retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon76.png" sizes="76x76">
	<!-- retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon114.png" sizes="114x114">
	<!-- retina iPhone iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon120.png" sizes="120x120">
	<!-- retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon144.png" sizes="144x144">
	<!-- retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon152.png" sizes="152x152">
	
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'epijim.co.uk');
  ga('send', 'pageview');

</script>
</head>


<body id="post">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a newer one to better enjoy this site?</a></div><![endif]-->
<div class="masthead-wrapper">
	<header id="masthead" itemscope itemtype="http://schema.org/Organization">
		<a href="http://epijim.co.uk" class="site-logo" rel="home" title="James Black" itemprop="url"><img src="http://epijim.co.uk/images/jimmy_logo.png" width="50" height="50" alt="James Black logo" itemprop="logo"></a>
		<span class="site-title" itemprop="name"><a href="http://epijim.co.uk">James Black</a></span>
	</header><!-- /.masthead -->
	<nav role="navigation" id="site-nav" class="nav">
		<ul>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/" itemprop="url"><span itemprop="name">Home</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/blog/" itemprop="url"><span itemprop="name">Blog</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/plots/" itemprop="url"><span itemprop="name">Gallery</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/my-papers/" itemprop="url"><span itemprop="name">My papers</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/about/" itemprop="url"><span itemprop="name">About me</span></a></li>
		
		</ul>
	</nav><!-- /#site-nav -->
</div><!-- /.entry-wrapper -->

<div id="main" role="main">
		<article class="hentry" itemscope itemtype="http://schema.org/Article">
		<header class="entry-header">
		
			<h1 class="entry-title" itemprop="name">Contour mapping Cambridge crime</h1>
		</header>
		<div class="entry-wrapper">
			<div class="entry-content" itemprop="articleBody">
				<p>The Cambridge Constabulary <a href="http://data.police.uk/data/">has location data</a> on just over 280,000 crimes that have happened
 between December 2010 and October 2013. It’s just too great of a dataset not to take a look…</p>

<figure>
	<a href="/images/crimes_1.png"><img src="/images/crimes_1.png" /></a>
	<figcaption>Crime density across the county.</figcaption>
</figure>

<p>Not surprisingly, the majority of crimes take place where the people are.
 So what about in Cambridge?</p>

<p>Each point below is a crime, and they are coded by the 16 types of crime that the police
 have pre-categorised. I didn’t bother with a key, as 16 is just too much to 
 get my head around at once.</p>

<figure>
	<a href="/images/crimes_2.png"><img src="/images/crimes_2.png" /></a>
	<figcaption>Two years of Cambridge crime plotted.</figcaption>
</figure>

<p>Below is the same map, focusing on the four types of crimes that looked interesting to me.</p>

<ul>
  <li>Antisocial behavior (I’m going to call them ASBOs, although really they are incidents not convictions or actual orders)</li>
  <li>Burglaries</li>
  <li>Drug related arrests</li>
  <li>Bicycle thefts</li>
</ul>

<figure>
	<a href="/images/crimes_3.png"><img src="/images/crimes_3.png" /></a>
	<figcaption>Stripping the 16 types down to just the four I'm interested in.</figcaption>
</figure>

<p>While it’s possible to see a possible clustering of bicycle thefts in the centre of town,
 and (not suprisingly) most burglaries seem to take place out of the centre, 
 it’s still hard to make out any patterns.</p>

<p>So is there really difference on where the crimes happen? Overlying the four types gets
 really messy. Below is the same four crime types overlaid. I removed the map entirely as 
 it’s already so cluttered, and I was mainly interested in how they overlapped.</p>

<figure>
	<a href="/images/crimes_4.png"><img src="/images/crimes_4.png" /></a>
	<figcaption>A rather messy contour plot of the four crimes densities.</figcaption>
</figure>

<p>Below is a density map of the 9 most common crimes. Shoplifting seems to be focused on the
 shopping malls, burglaries have a pretty decent spread. Interestingly, 
 there isn’t many bikes stolen from West Cambridge.</p>

<figure>
	<a href="/images/crimes_5.png"><img src="/images/crimes_5.png" /></a>
	<figcaption>Nine types of crime as density plots.</figcaption>
</figure>

<p>Looking at the four most interesting (to me) in detail, below.</p>

<figure>
	<a href="/images/crimes_6.png"><img src="/images/crimes_6.png" /></a>
	<figcaption>Zooming in on just the four most interesting.</figcaption>
</figure>

<p>Over the last 2 years, and within the bounds of my Cambridge maps, there were:</p>

<ul>
  <li>16,534 ASBOs</li>
  <li>2535 burglaries</li>
  <li>1502 drug related incidents</li>
  <li>1100 bicycle thefts</li>
</ul>

<p>Before I can use these plots I need to work out how to set the density scale as constant.
 The scales of a density plot, at least to me, are pretty random (it went up to 2,200) 
 for the plots above. As far as I can tell from the documentation, in the plot above, 
 it’s a common scale across each panel of the plot, but if you look at the numbers, 
 that doesn’t seem to be the case.</p>

<p>Below is the four plots individually, where the density limits vary. Definitely something
 I need to figure out before using these plots for real.</p>

<figure>
	<a href="/images/crimes_7.gif"><img src="/images/crimes_7.gif" /></a>
	<figcaption>Cycling through the types.</figcaption>
</figure>

<p>Below is the script to load up the csv’s, as you get them from
 <a href="http://data.police.uk/data/">the police website</a>.</p>

<div class="highlight"><pre><code class="r">setwd<span class="p">(</span><span class="s">&quot;Directoy where the data is saved&quot;</span><span class="p">)</span>
 
library<span class="p">(</span>plyr<span class="p">)</span> <span class="c1"># used to read in csvs</span>
library<span class="p">(</span>psych<span class="p">)</span> <span class="c1"># has the describe function</span>
 
<span class="c1">################</span>
<span class="c1"># import data  #</span>
<span class="c1">################</span>
 
<span class="c1"># Data is in monthly CSV&#39;s, so loop over them pulling in data</span>
  
  <span class="c1"># CAREFUL this will get all .csv names in directory</span>
  temp_filenames <span class="o">=</span> list.files<span class="p">(</span>pattern<span class="o">=</span><span class="s">&quot;*.csv&quot;</span><span class="p">)</span> 
  
  <span class="c1">#Now we have a list of the csv names, read them into one data frame</span>
  crime_data <span class="o">&lt;-</span> ldply<span class="p">(</span>temp_filenames<span class="p">,</span> read.csv<span class="p">)</span>
  <span class="c1">#could do in full like below, but prefer the shorter method above using plyr</span>
  <span class="c1">#crime_data &lt;- do.call(&quot;rbind&quot;, lapply(temp, read.csv, header = TRUE)) </span>
 
<span class="c1"># take a gander!</span>
  head<span class="p">(</span>crime_data<span class="p">)</span>
  summary<span class="p">(</span>crime_data<span class="p">)</span>
  describe<span class="p">(</span>crime_data<span class="p">)</span>
  str<span class="p">(</span>crime_data<span class="p">)</span>
  <span class="c1"># so 228, 949 crimes are in the database, </span>
  <span class="c1"># seems most the crime ID stuff came in later, and ties into the seperate</span>
  <span class="c1"># outcome data. Same with context. For now I&#39;ll focus on location, </span>
  <span class="c1"># time and type of crime</span>
 
  <span class="c1">#DATA ISSUES. Time is a factor variable.</span>
</code></pre></div>

<p>And now plot it.</p>

<div class="highlight"><pre><code class="r">  theme_bare <span class="o">&lt;-</span> theme<span class="p">(</span>axis.line <span class="o">=</span> element_blank<span class="p">(),</span> 
                      axis.text.x <span class="o">=</span> element_blank<span class="p">(),</span> 
                      axis.text.y <span class="o">=</span> element_blank<span class="p">(),</span>
                      axis.ticks <span class="o">=</span> element_blank<span class="p">(),</span> 
                      axis.title.x <span class="o">=</span> element_blank<span class="p">(),</span> 
                      axis.title.y <span class="o">=</span> element_blank<span class="p">(),</span>
                      legend.position <span class="o">=</span> <span class="s">&quot;none&quot;</span><span class="p">)</span>
 
cambridge <span class="o">&lt;-</span> get_map<span class="p">(</span>location<span class="o">=</span><span class="s">&quot;Cambridge, UK&quot;</span><span class="p">,</span> zoom<span class="o">=</span><span class="m">13</span><span class="p">,</span> color<span class="o">=</span><span class="s">&quot;bw&quot;</span><span class="p">,</span> source<span class="o">=</span><span class="s">&quot;osm&quot;</span><span class="p">)</span>
 
CambridgeMap <span class="o">&lt;-</span> ggmap<span class="p">(</span>cambridge<span class="p">,</span> baselayer <span class="o">=</span> ggplot<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>Longitude<span class="p">,</span> y<span class="o">=</span>Latitude<span class="p">),</span>
                                                    data<span class="o">=</span>crime_data<span class="p">))</span>
 
CambridgeMap <span class="o">+</span> stat_density2d<span class="p">(</span>aes<span class="p">(</span> x<span class="o">=</span>Longitude<span class="p">,</span>y<span class="o">=</span>Latitude<span class="p">,</span> 
                                   fill<span class="o">=</span>..level.. <span class="p">,</span> alpha<span class="o">=</span>..level.. <span class="p">),</span> 
                              data<span class="o">=</span>crime_data<span class="p">,</span> bins<span class="o">=</span><span class="m">6</span> <span class="p">,</span>geom <span class="o">=</span> <span class="s">&quot;polygon&quot;</span> <span class="p">)</span> <span class="o">+</span> 
                              scale_fill_gradient<span class="p">(</span>low <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> high <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="o">+</span> 
                              facet_wrap<span class="p">(</span><span class="o">~</span> Crime.type<span class="p">)</span> <span class="o">+</span> theme_bare
</code></pre></div>


				<div class="entry-related">
					<h2>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.co.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h2>
					<ul>
						
						<li><a href="http://epijim.co.uk/articles/restaurant-hygiene/">Restaurant hygiene ratings in Cambridge</a></li>
						
						<li><a href="http://epijim.co.uk/articles/3Dscatter/">3D scatter plot in R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/ski-2014/">Plotting data from the ski tracks app in R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/pathsinr/">Plotting paths in R</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<hr />
				<div class="entry-meta">
					<meta itemprop="keywords" content="R, Map, Cambridge">
					<span class="entry-tags"><a href="http://epijim.co.uk/tag/r/" title="R" class="tag" rel="tag">R</a><a href="http://epijim.co.uk/tag/map/" title="Map" class="tag" rel="tag">Map</a><a href="http://epijim.co.uk/tag/cambridge/" title="Cambridge" class="tag" rel="tag">Cambridge</a></span>
					<span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Published by <span itemprop="name" class="fn"><a href="http://epijim.co.uk/about/" title="About James Black" itemprop="url">James Black</a></span> on </span>
					<span class="entry-date"><time datetime="2014-02-19T00:00:00+00:00" itemprop="datePublished" class="published updated">February 19, 2014</time></span>
				</div><!-- /.entry-meta -->
			</div><!-- /.entry-content -->
			
			<div id="disqus_thread" class="entry-content"></div><!-- /#disqus_thread -->
			<noscript><div class="upgrade">Please enable JavaScript to view comments.</div><!-- /.upgrade --></noscript>
			
		</div><!-- /.entry-wrapper -->
	</article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <p>&#169; 2004&#8211;2014 <a href="http://epijim.co.uk/about/">James Black</a>, this site is written in markdown, compiled to html by jekyll, and hosted on github.pages.io. <a href="http://epijim.co.uk/humans.txt">Theme source and credits here</a>.</p>
		<div class="social-icons">
			
			
			<a href="http://github.com/epijim" title="James Black on Github" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a>
			
			<a href="https://plus.google.com/112022213613617220776/" title="James Black on Google+" target="_blank"><i class="fa fa-google-plus-square fa-fw fa-2x"></i></a>
			
			
		</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" data-cfasync="false"></script>
<script data-cfasync="false">window.jQuery || document.write('<script src="http://epijim.co.uk/js/vendor/jquery-397754ba49e9e0cf4e7c190da78dda05.js"><\/script>')</script>
<script src="http://epijim.co.uk/js/main.min-b1c052388578ab3b44858ccabf1f47d6.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
	var _gaq = _gaq || [];
	var pluginUrl = 
	'//www.google-analytics.com/plugins/ga/inpage_linkid.js';
	_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
	_gaq.push(['_setAccount', '']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<!-- Modernizr -->
<script src="http://epijim.co.uk/js/vendor/modernizr-ab083e250330742e0b9d2a5548ea8745.js"></script>


<!-- Disqus Comments -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesblack'; // Required - Replace example with your forum shortname
    var disqus_title = 'Contour mapping Cambridge crime';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


</body>
</html>
