<!doctype html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7 no-js" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="lt-ie9 lt-ie8 no-js" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="lt-ie9 no-js" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"><!--<![endif]-->

<head>
	<meta charset="utf-8">
	<title>Wine spend and academic performance &#8211; James Black</title>
	<meta name="description" content="Wine budget and academic performance at Cambridge University.">
	<meta name="keywords" content="R, Wine, Cambridge University">
	<!-- Twitter Cards -->
	
		<meta name="twitter:card" content="summary">
			<meta name="twitter:image" content="http://epijim.co.uk/images/wine_thumb.png">
		
	
	<meta name="twitter:title" content="Wine spend and academic performance">
	<meta name="twitter:description" content="Wine budget and academic performance at Cambridge University.">
	<meta name="twitter:site" content="@">
	<meta name="twitter:creator" content="@">
	
<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Wine spend and academic performance">
<meta property="og:description" content="Wine budget and academic performance at Cambridge University.">
<meta property="og:url" content="http://epijim.co.uk/articles/wine-budget/">
<meta property="og:image" content="http://epijim.co.uk/images/wine_thumb.png">
<meta property="og:site_name" content="James Black">

	<!-- Webmaster Tools verifications -->
	
	

	
	<link rel="canonical" href="http://epijim.co.uk/articles/wine-budget/">
	<link href="http://feeds.feedburner.com/epijim" type="application/atom+xml" rel="alternate" title="James Black &#8211; Everything Feed">
	<link rel="author" href="https://plus.google.com/112022213613617220776/?rel=author">

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta http-equiv="cleartype" content="on">

	<!-- For all browsers -->
	<link rel="stylesheet" href="http://epijim.co.uk/css/main.min-92de9747e44e9254411a46b258723e1d.css">

	<!-- Web fonts -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
	<script src="//use.edgefonts.net/lato:n3,i3,n4,i4,n7.js"></script>

	<!-- HTML5 Shiv and Media Query Support -->
	<!--[if lt IE 9]>
		<script src="http://epijim.co.uk/js/vendor/html5shiv-5a98a86b5cb48c1506f338463259ce41.js"></script>
		<script src="http://epijim.co.uk/js/vendor/respond-e5d7fffb3a9f891c926ee1b836d448d8.js"></script>
	<![endif]-->

	<!-- Icons -->
	<!-- 16x16 -->
	<link rel="shortcut icon" href="http://epijim.co.uk/favicon.ico">
	<!-- 32x32 -->
	<link rel="shortcut icon" href="http://epijim.co.uk/favicon.png">
	<!-- non-retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon57.png" sizes="57x57">
	<!-- non-retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon72.png" sizes="72x72">
	<!-- non-retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon76.png" sizes="76x76">
	<!-- retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon114.png" sizes="114x114">
	<!-- retina iPhone iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon120.png" sizes="120x120">
	<!-- retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon144.png" sizes="144x144">
	<!-- retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon152.png" sizes="152x152">
	
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'epijim.co.uk');
  ga('send', 'pageview');

</script>
</head>


<body id="post">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a newer one to better enjoy this site?</a></div><![endif]-->
<div class="masthead-wrapper">
	<header id="masthead" itemscope itemtype="http://schema.org/Organization">
		<a href="http://epijim.co.uk" class="site-logo" rel="home" title="James Black" itemprop="url"><img src="http://epijim.co.uk/images/jimmy_logo.png" width="50" height="50" alt="James Black logo" itemprop="logo"></a>
		<span class="site-title" itemprop="name"><a href="http://epijim.co.uk">James Black</a></span>
	</header><!-- /.masthead -->
	<nav role="navigation" id="site-nav" class="nav">
		<ul>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/" itemprop="url"><span itemprop="name">Home</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/blog/" itemprop="url"><span itemprop="name">Blog</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/plots/" itemprop="url"><span itemprop="name">Gallery</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/my-papers/" itemprop="url"><span itemprop="name">My papers</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/about/" itemprop="url"><span itemprop="name">About me</span></a></li>
		
		</ul>
	</nav><!-- /#site-nav -->
</div><!-- /.entry-wrapper -->

<div id="main" role="main">
		<article class="hentry" itemscope itemtype="http://schema.org/Article">
		<header class="entry-header">
		
			<h1 class="entry-title" itemprop="name">Wine spend and academic performance</h1>
		</header>
		<div class="entry-wrapper">
			<div class="entry-content" itemprop="articleBody">
				<p>About a week ago a good friend of mine, Tim, showed me a link to an economist blog post<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>
 that plotted the wine budget of Cambridge Colleges. The figure from that blog post is below.</p>

<figure>
	<a href="/images/wine.jpg"><img src="/images/wine.jpg" /></a>
	<figcaption>The well travelled plot mentioned by the economist.com (THIS PLOT IS NOT BY ME).</figcaption>
</figure>

<p>Below, I took the data from the original plot above, and rendered it as an interactive
  javascript plot - hover over a point to see the college info.
  The author of the original plot used a log scale. Which fit the model better, but obscured 
  just how much money King’s, John’s and Jesus spend.</p>

<p><em>I’ll slowly post all the code for all the plots and regressions past this point as I get the time to
 tidy up the syntax.</em></p>

<html>
  <head>
    
    <script src="http://ramnathv.github.io/rCharts/libraries/widgets/polycharts/js/polychart2.standalone.js" type="text/javascript"></script>
    
    <style>
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 550px;
      height: 400px;
    }  
    </style>
    
  </head>
  <body>
    <div id="chart38dc461cfd8b" class="rChart polycharts"></div>  
    
    <script type="text/javascript">
    var chartParams = {
 "dom": "chart38dc461cfd8b",
"width":    550,
"height":    400,
"layers": [
 {
 "x": "Wine_budget",
"y": "Firsts_2013",
"data": {
"Wine_budget": [ 71055, 87685, 79989, 79254, 77798, 131127, 23028, 30051, 96994, 27975, 14034, 212256, 338559, 68192, 32917, 27263, 141692, 82133, 111113, 44722, 49498, 97507, 62432, 19304, 260064, 223292, 127186, 39647 ],
"Firsts_2013": [   24.7,   28.3,   25.3,   23.9,     23,   30.5,   21.4,   18.5,   21.1,     16,   13.2,   27.1,   25.9,   22.8,   13.9,   15.8,   33.7,   27.8,   26.3,   16.2,   21.6,   19.8,   26.9,   13.4,   25.1,   41.7,   28.1,   18.9 ],
"College_char": [ "Christ's", "Churchill", "Clare", "Corpus Christi", "Downing", "Emma", "Fitzwilliam", "Girton", "Caius", "Homerton", "Hughes Hall", "Jesus", "King's", "Magdalene", "Murray Edwards", "Newnham", "Pembroke", "Peterhouse", "Queens", "Robinson", "Selwyn", "Sidney", "St Catharine's", "St Edmund's", "St John's", "Trinity", "Trinity Hall", "Wolfson" ],
},
"facet": null,
"type": "point",
"width":    500,
"color": "College_char" 
} 
],
"facet": [],
"guides": {
 "y": {
 "min":      0,
"max":     40,
"title": "% with firsts" 
},
"x": {
 "min":      0,
"max":  4e+05,
"title": "Yearly wine budget in millions (£)" 
},
"color": {
 "numticks": 28,
"labels": [ "Caius", "Christ's", "Churchill", "Clare", "Corpus Christi", "Downing", "Emma", "Fitzwilliam", "Girton", "Homerton", "Hughes Hall", "Jesus", "King's", "Magdalene", "Murray Edwards", "Newnham", "Pembroke", "Peterhouse", "Queens", "Robinson", "Selwyn", "Sidney", "St Catharine's", "St Edmund's", "St John's", "Trinity", "Trinity Hall", "Wolfson" ] 
} 
},
"coord": [],
"id": "chart38dc461cfd8b" 
}
    _.each(chartParams.layers, function(el){
        el.data = polyjs.data(el.data)
    })
    var graph_chart38dc461cfd8b = polyjs.chart(chartParams);
</script>
    
  </body>
</html>

<p>Now I’m going to add a disclaimer - <strong>this is not a robust analysis</strong>. I removed Lucy,
 and the grad only colleges (as they don’t get ranked), and I am purposely ignoring college
 assets. It seems the money a college has is hugely associated with academic performance, and 
 there is a large degree of multi- collinearity with their wine spend. Which would completely
 ruin my chance to run some models and make some plots.</p>

<p>So - with that out of the way, how are the characteristics of the colleges correlated?
 Below is plot from <em>ggpairs</em>, that automatically produces two pairwise plots for every variable.</p>

<figure>
	<a href="/images/wine_1_scattermatrix.png"><img src="/images/wine_1_scattermatrix.png" /></a>
	<figcaption>Scatterplot matrix of pairwise correlations. Plot type is defined by data in each pair.</figcaption>
</figure>

<p>So the Tompkins Score<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> has a near perfect correlation with percent firsts. As the score is
 based on undergrad results, this makes sense. More interesting is that there is a pretty 
 good correlation between the younger a college is and the worse it’s students perform (see inside 
 the blue boxes). Below is just the continuous variables in a scatterplot by the <em>corrgram</em> function. 
 The red line with an ellipse is a Loess smoothed line (like an average) with a 68% concentration
 eclipse. You can interpret this as; inside the ellipse, that red line is a fairly good indication 
 of the association between the two variables.</p>

<figure>
	<a href="/images/wine_2_scattermatrix_corrgram.png"><img src="/images/wine_2_scattermatrix_corrgram.png" /></a>
	<figcaption>Scatterplot using an alternative plotting function (this one can't handle categories as well).</figcaption>
</figure>

<p>So going back to wine spend vs. percent with firsts - is it just that bigger colleges spend more?</p>

<figure class="half">
	<img src="/images/wine_3a_wine_firsts.png" />
	<img src="/images/wine_3b_wine2people_firsts.png" />
	<figcaption>On the left is the raw wine budget, on the right the x-axis is wine per college member.</figcaption>
</figure>

<p>The plot above suggests no. So what would the regression models look like? </p>

<h3 id="y--x">y ~ x</h3>

<p>In the most basic model, a linear regression of % with firsts against the wine budget
 (actually using the natural log of the wine budget in the model),</p>

<ul>
  <li>61% of the variation is explained by the model</li>
  <li>wine budget effect is significant (p=0.000001)</li>
  <li>and going from spending £50,000 a year to £100,000 a year on wine results in the proportion of students getting a first going from 21.2% (95%CI 12,30) to 28.0% (95%CI 19,37).</li>
</ul>

<h3 id="y--x--z">y ~ x + z</h3>

<p>A model where I’ve used Ordinary Least Squares (OLS) regression to attempt to adjust for the
 number of college members, the age of the college, and the proportion that are female.
 There are a lot of caveats here - there is no obvious causal pathway. Loosely, an 
 older college is more likely to have amassed a lot of assets, and have the capacity to get into 
 wine speculation. Female dominated colleges, by virtue of there being no females at Cambridge 
 in the far too recent past, are likely to be young colleges.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p>

<p>I’ve also ignored a few other variables - I won’t go into details, but I did a (lazy)
 forward selection, basing my decision mainly on how the coefficients moved as variables
 were added.</p>

<p>So, while the conceptual underpinnings of this are a mess…. 
what do the numbers look like if I attempt to adjust out 
 the effect of the number of members in the college, it’s age, and the percent female?</p>

<p>The results of this adjusted model are,</p>

<ul>
  <li>65% of the variation is explained by the model</li>
  <li>wine budget effect is significant (p=0.00752)</li>
  <li>and going from spending £50,000 a year to £100,000 a year on wine results in the proportion of students getting a first going from 21.8% (95%CI 13,31) to 26.6% (95%CI 18,36).</li>
</ul>

<figure>
	<a href="/images/wine_5_ModelResiduals.png"><img src="/images/wine_5_ModelResiduals.png" /></a>
	<figcaption>Residuals from the adjusted OLS model.</figcaption>
</figure>

<p>Above is a summary of the model fit. It’s not perfect, and a few colleges stand out as not fitting
 particularly well. Interesting here is that two colleges in particular hold a lot of sway in the 
 model. A common rule of thumb is that if an observation has a Cook’s distance greater than four 
 divided by your total number of observations, your analysis is unstable. </p>

<p>Using that rule, there are two colleges that are very influential to my results. Homerton
 and Trinity. It’s easy to see why. Homerton is mainly female (63%), is 38 years old, performs badly 
 (16% get firsts) and spends about £20 per member a year on wine. While Trinity is mainly male (37% female) 
 is 468 years old, has exceptional under grads (42% get firsts) and spends £179 per member a year on wine.</p>

<p>Another way to look at this is the influence plot, below.</p>

<figure>
	<a href="/images/wine_influence.png"><img src="/images/wine_influence.png" /></a>
	<figcaption>A “bubble” plot of Studentized residuals by hat values, with the areas of the circles representing the observations proportional to Cook's distances. Vertical reference lines are drawn at twice and three times the average hat value, horizontal reference lines at -2, 0, and 2 on the Studentized-residual scale.</figcaption>
</figure>

<p>So what is the effect of these variables I’m trying to adjust out? Below is an Added Variables Plot (AVP).
 This plot shows the effect of adding in a new variable, if the others are already in the model.
 This shows the positive relationship between age of college, wine budget, and number of people,
 and the negative association between percent female and performance.</p>

<figure>
	<a href="/images/wine_4_AVP_WinePerAgeFem.png"><img src="/images/wine_4_AVP_WinePerAgeFem.png" /></a>
	<figcaption>Added variable plot.</figcaption>
</figure>

<p>So there are outliers, and I don’t really have a valid reason for excluding them. Two ways
 to dampen the effect of outliers is robust and quantile regression. Adjusted results are below,</p>

<h3 id="quantile-regression">Quantile regression</h3>

<ul>
  <li>Going from spending £50,000 a year to £100,000 a year on wine results in the
  proportion of students getting a first going from 21.4% to 26.3%.</li>
</ul>

<h3 id="robust-regression">Robust regression</h3>

<ul>
  <li>Going from spending £50,000 a year to £100,000 a year on wine results in the proportion 
 of students getting a first going from 21.5% to 25.9%.</li>
</ul>

<p>And finally, all the models looking at wine budget vs. percent with firsts, plotted together.</p>

<figure>
	<a href="/images/wine_6_comparemodels.png"><img src="/images/wine_6_comparemodels.png" /></a>
	<figcaption>Added variable plot.</figcaption>
</figure>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>The graph was actually by a Cambridge grad, but the economist <a href="http://www.economist.com/blogs/freeexchange/2014/02/correlation-and-causation">post is here.</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>The Tompkins score allocates 5 points for a First Class degree, 3 points for an Upper Second (known also as a 2.i), 2 points for a Lower Second (a 2.ii), 1 point for a Third and no points for someone only granted an allowance towards an Ordinary Degree. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>This also suggests I maybe should of looked at female as binary (all female or mixed). <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<div class="entry-related">
					<h2>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.co.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h2>
					<ul>
						
						<li><a href="http://epijim.co.uk/articles/regression/">Linear regression with R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/bubbletable/">Bubble tables with R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/bitcoin/">The barons of bitcoin</a></li>
						
						<li><a href="http://epijim.co.uk/articles/hindex/">Publish or perish - there's a model for that.</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<hr />
				<div class="entry-meta">
					<meta itemprop="keywords" content="R, Wine, Cambridge University">
					<span class="entry-tags"><a href="http://epijim.co.uk/tag/r/" title="R" class="tag" rel="tag">R</a><a href="http://epijim.co.uk/tag/wine/" title="Wine" class="tag" rel="tag">Wine</a><a href="http://epijim.co.uk/tag/cambridge-university/" title="Cambridge University" class="tag" rel="tag">Cambridge University</a></span>
					<span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Published by <span itemprop="name" class="fn"><a href="http://epijim.co.uk/about/" title="About James Black" itemprop="url">James Black</a></span> on </span>
					<span class="entry-date"><time datetime="2014-02-10T00:00:00+00:00" itemprop="datePublished" class="published updated">February 10, 2014</time></span>
				</div><!-- /.entry-meta -->
			</div><!-- /.entry-content -->
			
			<div id="disqus_thread" class="entry-content"></div><!-- /#disqus_thread -->
			<noscript><div class="upgrade">Please enable JavaScript to view comments.</div><!-- /.upgrade --></noscript>
			
		</div><!-- /.entry-wrapper -->
	</article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <p>&#169; 2004&#8211;2014 <a href="http://epijim.co.uk/about/">James Black</a>, this site is written in markdown, compiled to html by jekyll, and hosted on github.pages.io. <a href="http://epijim.co.uk/humans.txt">Theme source and credits here</a>.</p>
		<div class="social-icons">
			
			
			<a href="http://github.com/epijim" title="James Black on Github" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a>
			
			<a href="https://plus.google.com/112022213613617220776/" title="James Black on Google+" target="_blank"><i class="fa fa-google-plus-square fa-fw fa-2x"></i></a>
			
			
		</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" data-cfasync="false"></script>
<script data-cfasync="false">window.jQuery || document.write('<script src="http://epijim.co.uk/js/vendor/jquery-397754ba49e9e0cf4e7c190da78dda05.js"><\/script>')</script>
<script src="http://epijim.co.uk/js/main.min-b1c052388578ab3b44858ccabf1f47d6.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
	var _gaq = _gaq || [];
	var pluginUrl = 
	'//www.google-analytics.com/plugins/ga/inpage_linkid.js';
	_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
	_gaq.push(['_setAccount', '']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<!-- Modernizr -->
<script src="http://epijim.co.uk/js/vendor/modernizr-ab083e250330742e0b9d2a5548ea8745.js"></script>


<!-- Disqus Comments -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesblack'; // Required - Replace example with your forum shortname
    var disqus_title = 'Wine spend and academic performance';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


</body>
</html>
