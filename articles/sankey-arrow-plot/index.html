<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Visualising flow with a sankey plot &#8211; James Black</title>
<meta name="description" content="Showing how to make a sankey plot using R.">
<meta name="keywords" content="R, Sankey">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Visualising flow with a sankey plot">
<meta property="og:description" content="Showing how to make a sankey plot using R.">
<meta property="og:url" content="http://0.0.0.0:4000/articles/sankey-arrow-plot/">
<meta property="og:site_name" content="James Black">





<link rel="canonical" href="http://0.0.0.0:4000/articles/sankey-arrow-plot/">
<link href="http://0.0.0.0:4000/feed.xml" type="application/atom+xml" rel="alternate" title="James Black Feed">
<link rel="author" href="https://plus.google.com/112022213613617220776/?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://0.0.0.0:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://0.0.0.0:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://0.0.0.0:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://0.0.0.0:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://0.0.0.0:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://0.0.0.0:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://0.0.0.0:4000/images/apple-touch-icon-144x144-precomposed.png">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'epijim.co.uk');
  ga('send', 'pageview');

</script>
</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="http://0.0.0.0:4000/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="http://0.0.0.0:4000/latest/">Latest</a>
				 
			</li>
	        
			<li>
				
					<a href="http://0.0.0.0:4000/tags/">Index</a>
				 
			</li>
	        
	        <li><a href="http://0.0.0.0:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="http://0.0.0.0:4000" class="site-logo" rel="home" title="James Black"><img src="http://0.0.0.0:4000/images/jimmy_logo.png" width="200" height="200" alt="James Black logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="http://0.0.0.0:4000">James Black</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Reading Epidemiology at Jesus College, University of Cambridge</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://0.0.0.0:4000/tags/#R" title="Pages tagged R">R</a>&nbsp;&bull;&nbsp;<a href="http://0.0.0.0:4000/tags/#Sankey" title="Pages tagged Sankey">Sankey</a></span>
        
          <h1 class="entry-title">Visualising flow with a sankey plot</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="http://0.0.0.0:4000/images/bio_photo.png" alt="James Black photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="http://0.0.0.0:4000/about/" title="About James Black">James Black</a></span></span>
        <span class="entry-date date published"><time datetime="2014-02-05T00:00:00+00:00"><i class="icon-calendar-empty"></i> February 05, 2014</time></span>
        
        <span class="entry-comments"><i class="icon-comment-alt"></i> <a href="#disqus_thread">Comment</a></span>
        <span><a href="http://0.0.0.0:4000/articles/sankey-arrow-plot/" rel="bookmark" title="Visualising flow with a sankey plot"><i class="icon-link"></i> Permalink</a></span>
        
        <span class="social-share-facebook">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://0.0.0.0:4000/articles/sankey-arrow-plot/" title="Share on Facebook" itemprop="Facebook"><i class="icon-facebook-sign"></i> Like</a></span>
        <span class="social-share-twitter">
            <a href="https://twitter.com/intent/tweet?text=http://0.0.0.0:4000/articles/sankey-arrow-plot/" title="Share on Twitter" itemprop="Twitter"><i class="icon-twitter-sign"></i> Tweet</a></span>
        <span class="social-share-googleplus">
            <a href="https://plus.google.com/share?url=http://0.0.0.0:4000/articles/sankey-arrow-plot/" title="Share on Google Plus" itemprop="GooglePlus"><i class="icon-google-plus-sign"></i> +1</a></span>
            <!-- /.social-share -->
      </footer>
      <div class="entry-content">
        <figure>
	<a href="/images/sankey_example.png"><img src="/images/sankey_example.png" /></a>
	<figcaption>An example of the function output, taken from my thesis.</figcaption>
</figure>

<p>Above is a Sankey plot that takes the number of individuals given the option of being
 screened for diabetes, and how individuals left the screening programme,
 till a fraction of the original number were diagnosed with diabetes.
 I’m using this figure in my PhD, and the numbers behind it come from a paper<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> describing 
 a diabetes screening trial that was run by my supervisors.</p>

<p>The original Sankey diagram visualised the efficiency of a steam engine, 
but a more famous example is probably Minard’s picture of Napoleon’s disastrous Russian 
campaign (below). The general idea behind these plots is that the width of the arrows is 
to scale, so you can see the flow much more instinctively than a standard flow chart. 
Although Minard took it a step further by plotting it over a map, and also plotting the temperatures.</p>

<figure>
	<a href="/images/sankey_minard.png"><img src="/images/sankey_minard.png" /></a>
	<figcaption>Minard's summary of the failed Russian Campaign.</figcaption>
</figure>

<p>The code is super simple to run. First the setup. We set the working directory, then set up
 a function to pull other functions and their dependencies from a Gist (an online repository).</p>

<div class="highlight"><pre><code class="r">setwd<span class="p">(</span><span class="s">&quot;~/Dropbox/Personal/fun with code/sankey_arrow&quot;</span><span class="p">)</span>
 
sourc.https     <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>url<span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># install and load the RCurl package </span>
  <span class="kr">if</span> <span class="p">(</span>match<span class="p">(</span><span class="s">&#39;RCurl&#39;</span><span class="p">,</span> nomatch<span class="o">=</span><span class="m">0</span><span class="p">,</span> installed.packages<span class="p">()[,</span><span class="m">1</span><span class="p">])</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    install.packages<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;RCurl&quot;</span><span class="p">),</span> dependencies <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
    require<span class="p">(</span>RCurl<span class="p">)</span>  
  <span class="p">}</span> <span class="kr">else</span> require<span class="p">(</span>RCurl<span class="p">)</span>    
  
  <span class="c1"># parse and evaluate each .R script</span>
  sapply<span class="p">(</span>c<span class="p">(</span>url<span class="p">,</span> <span class="kc">...</span><span class="p">),</span> <span class="kr">function</span><span class="p">(</span>u<span class="p">)</span> <span class="p">{</span>
    eval<span class="p">(</span>parse<span class="p">(</span>text <span class="o">=</span> getURL<span class="p">(</span>u<span class="p">,</span> followlocation <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> 
                             cainfo  <span class="o">=</span> system.file<span class="p">(</span><span class="s">&quot;CurlSSL&quot;</span><span class="p">,</span> <span class="s">&quot;cacert.pem&quot;</span><span class="p">,</span> 
                                                   package <span class="o">=</span> <span class="s">&quot;RCurl&quot;</span><span class="p">))),</span> envir <span class="o">=</span> .GlobalEnv<span class="p">)</span>
  <span class="p">}</span> <span class="p">)</span>
 
<span class="c1"># from https://gist.github.com/1423501</span>
sourc.https<span class="p">(</span><span class="s">&quot;https://gist.github.com/epijim/8832627/raw/91f8fb601a483a6e60c6cbc7eeea939e010cf7ce/Sankey.R&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>The last line of the previous code snippet read in the function to make the Sankey plot.
 I’m pulling it from my own Gist, rather than the official one, as I edited two lines that 
 effect how the text is written.</p>

<p>Then we just need to give the function the numbers that go in (inputs) and the numbers that
 go out. Then the labels in the same order. It’s crazy simple!</p>

<div class="highlight"><pre><code class="r">inputs <span class="o">=</span> c<span class="p">(</span><span class="m">35297</span><span class="p">)</span>
losses <span class="o">=</span> c<span class="p">(</span><span class="m">1758</span><span class="p">,</span><span class="m">8885</span><span class="p">,</span><span class="m">23787</span><span class="p">,</span><span class="m">867</span><span class="p">)</span>
unit <span class="o">=</span> <span class="s">&quot;n =&quot;</span>
 
labels <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;At high diabetes risk&quot;</span><span class="p">,</span>
           <span class="s">&quot;Did not meet criteria&quot;</span><span class="p">,</span>
           <span class="s">&quot;Did not attend screening&quot;</span><span class="p">,</span>
           <span class="s">&quot;Did not have diabetes&quot;</span><span class="p">,</span>
           <span class="s">&quot;Diagnosed with diabetes&quot;</span><span class="p">)</span>
  pdf<span class="p">(</span><span class="s">&quot;Sankey.pdf&quot;</span><span class="p">,</span> width<span class="o">=</span><span class="m">12</span><span class="p">,</span> height<span class="o">=</span><span class="m">10</span><span class="p">)</span>
    SankeyR<span class="p">(</span>inputs<span class="p">,</span>losses<span class="p">,</span>unit<span class="p">,</span>labels<span class="p">)</span>
  dev.off<span class="p">()</span>
</code></pre></div>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="http://www.ncbi.nlm.nih.gov/pubmed/19435491">Echouffo-Tcheugui et al(2009) BMC Public Health, 9:136</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://0.0.0.0:4000/articles/mapping-python/" class="btn" title="Mapping my google location data">Previous article</a>
      
      
        <a href="http://0.0.0.0:4000/articles/wine-budget/" class="btn" title="Wine spend and academic performance">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 James Black. Source theme by Michael Rose. Site is compiled by Kramdown into Jekyll and hosted on github.pages.io.</span>
<div class="social-icons">
	
	
	<a href="https://plus.google.com/112022213613617220776/" title="James Black on Google+" target="_blank"><i class="icon-google-plus icon-2x"></i></a>
	
	
	
	
	
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://0.0.0.0:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://0.0.0.0:4000/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://0.0.0.0:4000/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesblack'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
