<!doctype html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7 no-js" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="lt-ie9 lt-ie8 no-js" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="lt-ie9 no-js" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"><!--<![endif]-->

<head>
	<meta charset="utf-8">
	<title>Visualising flow with a sankey plot &#8211; James Black</title>
	<meta name="description" content="Showing how to make a sankey plot using R.">
	<meta name="keywords" content="R, Sankey">
	<!-- Twitter Cards -->
	
		<meta name="twitter:card" content="summary">
			<meta name="twitter:image" content="http://epijim.uk/images/sankey_thumb.png">
		
	
	<meta name="twitter:title" content="Visualising flow with a sankey plot">
	<meta name="twitter:description" content="Showing how to make a sankey plot using R.">
	<meta name="twitter:site" content="@">
	<meta name="twitter:creator" content="@">
	
<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Visualising flow with a sankey plot">
<meta property="og:description" content="Showing how to make a sankey plot using R.">
<meta property="og:url" content="http://epijim.uk/articles/sankey-arrow-plot/">
<meta property="og:image" content="http://epijim.uk/images/sankey_thumb.png">
<meta property="og:site_name" content="James Black">

	<!-- Webmaster Tools verifications -->
	
	

	
	<link rel="canonical" href="http://epijim.uk/articles/sankey-arrow-plot/">
	<link href="http://feeds.feedburner.com/epijim" type="application/atom+xml" rel="alternate" title="James Black &#8211; Everything Feed">
	<link rel="author" href="https://plus.google.com/112022213613617220776/?rel=author">

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta http-equiv="cleartype" content="on">

	<!-- For all browsers -->
	<link rel="stylesheet" href="http://epijim.uk/css/main.css">

	<!-- Web fonts -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
	<script src="//use.edgefonts.net/lato:n3,i3,n4,i4,n7.js"></script>

	<!-- HTML5 Shiv and Media Query Support -->
	<!--[if lt IE 9]>
		<script src="http://epijim.uk/js/vendor/html5shiv-5a98a86b5cb48c1506f338463259ce41.js"></script>
		<script src="http://epijim.uk/js/vendor/respond-e5d7fffb3a9f891c926ee1b836d448d8.js"></script>
	<![endif]-->

	<!-- Icons -->
	<!-- 16x16 -->
	<link rel="shortcut icon" href="http://epijim.uk/favicon.ico">
	<!-- 32x32 -->
	<link rel="shortcut icon" href="http://epijim.uk/favicon.png">
	<!-- non-retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon57.png" sizes="57x57">
	<!-- non-retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon72.png" sizes="72x72">
	<!-- non-retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.uk/images/icon76.png" sizes="76x76">
	<!-- retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon114.png" sizes="114x114">
	<!-- retina iPhone iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.uk/images/icon120.png" sizes="120x120">
	<!-- retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon144.png" sizes="144x144">
	<!-- retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.uk/images/icon152.png" sizes="152x152">
	
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'epijim.uk');
  ga('send', 'pageview');

</script>
</head>


<body id="post">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a newer one to better enjoy this site?</a></div><![endif]-->
<div class="masthead-wrapper">
	<header id="masthead" itemscope itemtype="http://schema.org/Organization">
		<a href="http://epijim.uk" class="site-logo" rel="home" title="James Black" itemprop="url"><img src="http://epijim.uk/images/jimmy_logo.png" width="50" height="50" alt="James Black logo" itemprop="logo"></a>
		<span class="site-title" itemprop="name"><a href="http://epijim.uk">James Black</a></span>
	</header><!-- /.masthead -->
	<nav role="navigation" id="site-nav" class="nav">
		<ul>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/" itemprop="url"><span itemprop="name">Home</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/blog/" itemprop="url"><span itemprop="name">Blog</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/plots/" itemprop="url"><span itemprop="name">Gallery</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/my-papers/" itemprop="url"><span itemprop="name">My papers</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/about/" itemprop="url"><span itemprop="name">About me</span></a></li>
		
		</ul>
	</nav><!-- /#site-nav -->
</div><!-- /.entry-wrapper -->

<div id="main" role="main">
		<article class="hentry" itemscope itemtype="http://schema.org/Article">
		<header class="entry-header">
		
			<h1 class="entry-title" itemprop="name">Visualising flow with a sankey plot</h1>
		</header>
		<div class="entry-wrapper">
			<div class="entry-content" itemprop="articleBody">
				<figure>
	<a href="/images/sankey_example.png"><img src="/images/sankey_example.png" /></a>
	<figcaption>An example of the function output, taken from my thesis.</figcaption>
</figure>

<p>Above is a Sankey plot that takes the number of individuals given the option of being
 screened for diabetes, and how individuals left the screening programme,
 till a fraction of the original number were diagnosed with diabetes.
 I’m using this figure in my PhD, and the numbers behind it come from a paper<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> describing 
 a diabetes screening trial that was run by my supervisors.</p>

<p>The original Sankey diagram visualised the efficiency of a steam engine, 
but a more famous example is probably Minard’s picture of Napoleon’s disastrous Russian 
campaign (below). The general idea behind these plots is that the width of the arrows is 
to scale, so you can see the flow much more instinctively than a standard flow chart. 
Although Minard took it a step further by plotting it over a map, and also plotting the temperatures.</p>

<figure>
	<a href="/images/sankey_minard.png"><img src="/images/sankey_minard.png" /></a>
	<figcaption>Minard's summary of the failed Russian Campaign.</figcaption>
</figure>

<p>The code is super simple to run. First the setup. We set the working directory, then set up
 a function to pull other functions and their dependencies from a Gist (an online repository).</p>

<div class="highlight"><pre><code class="r">setwd<span class="p">(</span><span class="s">&quot;~/Dropbox/Personal/fun with code/sankey_arrow&quot;</span><span class="p">)</span>
 
sourc.https     <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>url<span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># install and load the RCurl package </span>
  <span class="kr">if</span> <span class="p">(</span>match<span class="p">(</span><span class="s">&#39;RCurl&#39;</span><span class="p">,</span> nomatch<span class="o">=</span><span class="m">0</span><span class="p">,</span> installed.packages<span class="p">()[,</span><span class="m">1</span><span class="p">])</span><span class="o">==</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    install.packages<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;RCurl&quot;</span><span class="p">),</span> dependencies <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
    require<span class="p">(</span>RCurl<span class="p">)</span>  
  <span class="p">}</span> <span class="kr">else</span> require<span class="p">(</span>RCurl<span class="p">)</span>    
  
  <span class="c1"># parse and evaluate each .R script</span>
  sapply<span class="p">(</span>c<span class="p">(</span>url<span class="p">,</span> <span class="kc">...</span><span class="p">),</span> <span class="kr">function</span><span class="p">(</span>u<span class="p">)</span> <span class="p">{</span>
    eval<span class="p">(</span>parse<span class="p">(</span>text <span class="o">=</span> getURL<span class="p">(</span>u<span class="p">,</span> followlocation <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> 
                             cainfo  <span class="o">=</span> system.file<span class="p">(</span><span class="s">&quot;CurlSSL&quot;</span><span class="p">,</span> <span class="s">&quot;cacert.pem&quot;</span><span class="p">,</span> 
                                                   package <span class="o">=</span> <span class="s">&quot;RCurl&quot;</span><span class="p">))),</span> envir <span class="o">=</span> .GlobalEnv<span class="p">)</span>
  <span class="p">}</span> <span class="p">)</span>
 
<span class="c1"># from https://gist.github.com/1423501</span>
sourc.https<span class="p">(</span><span class="s">&quot;https://gist.github.com/epijim/8832627/raw/91f8fb601a483a6e60c6cbc7eeea939e010cf7ce/Sankey.R&quot;</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>The last line of the previous code snippet read in the function to make the Sankey plot.
 I’m pulling it from my own Gist, rather than the official one, as I edited two lines that 
 effect how the text is written.</p>

<p>Then we just need to give the function the numbers that go in (inputs) and the numbers that
 go out. Then the labels in the same order. It’s crazy simple!</p>

<div class="highlight"><pre><code class="r">inputs <span class="o">=</span> c<span class="p">(</span><span class="m">35297</span><span class="p">)</span>
losses <span class="o">=</span> c<span class="p">(</span><span class="m">1758</span><span class="p">,</span><span class="m">8885</span><span class="p">,</span><span class="m">23787</span><span class="p">,</span><span class="m">867</span><span class="p">)</span>
unit <span class="o">=</span> <span class="s">&quot;n =&quot;</span>
 
labels <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;At high diabetes risk&quot;</span><span class="p">,</span>
           <span class="s">&quot;Did not meet criteria&quot;</span><span class="p">,</span>
           <span class="s">&quot;Did not attend screening&quot;</span><span class="p">,</span>
           <span class="s">&quot;Did not have diabetes&quot;</span><span class="p">,</span>
           <span class="s">&quot;Diagnosed with diabetes&quot;</span><span class="p">)</span>
  pdf<span class="p">(</span><span class="s">&quot;Sankey.pdf&quot;</span><span class="p">,</span> width<span class="o">=</span><span class="m">12</span><span class="p">,</span> height<span class="o">=</span><span class="m">10</span><span class="p">)</span>
    SankeyR<span class="p">(</span>inputs<span class="p">,</span>losses<span class="p">,</span>unit<span class="p">,</span>labels<span class="p">)</span>
  dev.off<span class="p">()</span></code></pre></div>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="http://www.ncbi.nlm.nih.gov/pubmed/19435491">Echouffo-Tcheugui et al(2009) BMC Public Health, 9:136</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<div class="entry-related">
					<h2>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h2>
					<ul>
						
						<li><a href="http://epijim.uk/articles/worldcup14/">Changing fate of the German football team</a></li>
						
						<li><a href="http://epijim.uk/articles/CamTrad2014/">Does Redbull give you wings?</a></li>
						
						<li><a href="http://epijim.uk/articles/sheep/">New Zealand and sheep</a></li>
						
						<li><a href="http://epijim.uk/articles/bitcoin/">The barons of bitcoin</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<hr />
				<div class="entry-meta">
					<meta itemprop="keywords" content="R, Sankey">
					<span class="entry-tags"><a href="http://epijim.uk/tag/r/" title="R" class="tag" rel="tag">R</a><a href="http://epijim.uk/tag/sankey/" title="Sankey" class="tag" rel="tag">Sankey</a></span>
					<span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Published by <span itemprop="name" class="fn"><a href="http://epijim.uk/about/" title="About James Black" itemprop="url">James Black</a></span> on </span>
					<span class="entry-date"><time datetime="2014-02-05T00:00:00+00:00" itemprop="datePublished" class="published updated">February 05, 2014</time></span>
				</div><!-- /.entry-meta -->
			</div><!-- /.entry-content -->
			
			<div id="disqus_thread" class="entry-content"></div><!-- /#disqus_thread -->
			<noscript><div class="upgrade">Please enable JavaScript to view comments.</div><!-- /.upgrade --></noscript>
			
		</div><!-- /.entry-wrapper -->
	</article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <p>&#169; 2004&#8211;2014 <a href="http://epijim.uk/about/">James Black</a>, this site is written in markdown, compiled to html by jekyll, and hosted on github.pages.io. <a href="http://epijim.uk/humans.txt">Theme source and credits here</a>.</p>
		<div class="social-icons">
			
			
			<a href="http://github.com/epijim" title="James Black on Github" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a>
			
			<a href="https://plus.google.com/112022213613617220776/" title="James Black on Google+" target="_blank"><i class="fa fa-google-plus-square fa-fw fa-2x"></i></a>
			
			
		</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" data-cfasync="false"></script>
<script data-cfasync="false">window.jQuery || document.write('<script src="http://epijim.uk/js/vendor/jquery-397754ba49e9e0cf4e7c190da78dda05.js"><\/script>')</script>
<script src="http://epijim.uk/js/main.min-b1c052388578ab3b44858ccabf1f47d6.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
	var _gaq = _gaq || [];
	var pluginUrl = 
	'//www.google-analytics.com/plugins/ga/inpage_linkid.js';
	_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
	_gaq.push(['_setAccount', '']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<!-- Modernizr -->
<script src="http://epijim.uk/js/vendor/modernizr-ab083e250330742e0b9d2a5548ea8745.js"></script>


<!-- Disqus Comments -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesblack'; // Required - Replace example with your forum shortname
    var disqus_title = 'Visualising flow with a sankey plot';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


</body>
</html>
