<!doctype html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7 no-js" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="lt-ie9 lt-ie8 no-js" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="lt-ie9 no-js" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"><!--<![endif]-->

<head>
	<meta charset="utf-8">
	<title>Distance to the nearest pub &#8211; James Black</title>
	<meta name="description" content="Geo-coding distances using R.">
	<meta name="keywords" content="R, Geo-coding">
	<!-- Twitter Cards -->
	
		<meta name="twitter:card" content="summary">
			<meta name="twitter:image" content="http://epijim.uk/images/pub_thumb.png">
		
	
	<meta name="twitter:title" content="Distance to the nearest pub">
	<meta name="twitter:description" content="Geo-coding distances using R.">
	<meta name="twitter:site" content="@">
	<meta name="twitter:creator" content="@">
	
<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Distance to the nearest pub">
<meta property="og:description" content="Geo-coding distances using R.">
<meta property="og:url" content="http://epijim.uk/articles/pub-distances/">
<meta property="og:image" content="http://epijim.uk/images/pub_thumb.png">
<meta property="og:site_name" content="James Black">

	<!-- Webmaster Tools verifications -->
	
	

	
	<link rel="canonical" href="http://epijim.uk/articles/pub-distances/">
	<link href="http://feeds.feedburner.com/epijim" type="application/atom+xml" rel="alternate" title="James Black &#8211; Everything Feed">
	<link rel="author" href="https://plus.google.com/112022213613617220776/?rel=author">

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta http-equiv="cleartype" content="on">

	<!-- For all browsers -->
	<link rel="stylesheet" href="http://epijim.uk/css/main.min-92de9747e44e9254411a46b258723e1d.css">

	<!-- Web fonts -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
	<script src="//use.edgefonts.net/lato:n3,i3,n4,i4,n7.js"></script>

	<!-- HTML5 Shiv and Media Query Support -->
	<!--[if lt IE 9]>
		<script src="http://epijim.uk/js/vendor/html5shiv-5a98a86b5cb48c1506f338463259ce41.js"></script>
		<script src="http://epijim.uk/js/vendor/respond-e5d7fffb3a9f891c926ee1b836d448d8.js"></script>
	<![endif]-->

	<!-- Icons -->
	<!-- 16x16 -->
	<link rel="shortcut icon" href="http://epijim.uk/favicon.ico">
	<!-- 32x32 -->
	<link rel="shortcut icon" href="http://epijim.uk/favicon.png">
	<!-- non-retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon57.png" sizes="57x57">
	<!-- non-retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon72.png" sizes="72x72">
	<!-- non-retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.uk/images/icon76.png" sizes="76x76">
	<!-- retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon114.png" sizes="114x114">
	<!-- retina iPhone iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.uk/images/icon120.png" sizes="120x120">
	<!-- retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.uk/images/icon144.png" sizes="144x144">
	<!-- retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.uk/images/icon152.png" sizes="152x152">
	
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'epijim.co.uk');
  ga('send', 'pageview');

</script>
</head>


<body id="post">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a newer one to better enjoy this site?</a></div><![endif]-->
<div class="masthead-wrapper">
	<header id="masthead" itemscope itemtype="http://schema.org/Organization">
		<a href="http://epijim.uk" class="site-logo" rel="home" title="James Black" itemprop="url"><img src="http://epijim.uk/images/jimmy_logo.png" width="50" height="50" alt="James Black logo" itemprop="logo"></a>
		<span class="site-title" itemprop="name"><a href="http://epijim.uk">James Black</a></span>
	</header><!-- /.masthead -->
	<nav role="navigation" id="site-nav" class="nav">
		<ul>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/" itemprop="url"><span itemprop="name">Home</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/blog/" itemprop="url"><span itemprop="name">Blog</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/plots/" itemprop="url"><span itemprop="name">Gallery</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/my-papers/" itemprop="url"><span itemprop="name">My papers</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.uk/about/" itemprop="url"><span itemprop="name">About me</span></a></li>
		
		</ul>
	</nav><!-- /#site-nav -->
</div><!-- /.entry-wrapper -->

<div id="main" role="main">
		<article class="hentry" itemscope itemtype="http://schema.org/Article">
		<header class="entry-header">
		
			<h1 class="entry-title" itemprop="name">Distance to the nearest pub</h1>
		</header>
		<div class="entry-wrapper">
			<div class="entry-content" itemprop="articleBody">
				<p>The plot below shows the distance to the nearest bar or pub (in blue), from a grid of
 spots in Cambridge. Starting in the top left of the green box, I ran a python script that calls 
 the Google Places API to ask where the nearest “bar” is. It then moves 100m right, 
 and asks again. When it hits the far side of the green box, it drops down 100m and 
 makes a new call every 100m. Distances are coloured based on the distance google maps 
 claims it is from points on the grid, to the nearest bar. The plot is then put together 
 using ggmap in R.</p>

<figure>
	<a href="/images/pub_1_pub.png"><img src="/images/pub_1_pub.png" /></a>
	<figcaption>Distance to the nearest pub from a grid of points in Cambridge.</figcaption>
</figure>

<p>Nathan Yau wrote a brilliant book called Datapoints<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, where he introduces this style of
 map, and it is from there that I picked up the code to handle the geo-coding.</p>

<p>Google has all the listed businesses in Cambridge coded into types (e.g.
 restaurant, dentist, mall, etc). Unfortunately – google map’s hasn’t got the “types” 
 coded very reliably. So this map should be taken with a grain of salt.</p>

<p>The map itself becomes easier to read when looking at a less common places around
 Cambridge. Below is a plot of distances to the nearest “<em>grocery_or_supermarket</em>” in 
 Cambridge. Approach this with extra caution though, as things like the King Street 
 off licence are included in this category. Here you can see the South East is very 
 well served, while there is hardly anywhere to buy a 4-pack of fosters and a potato 
 in West Cambridge. I found it quite interesting how distance as the crow flies to the 
 nearest off licence or supermarket was quite often not the fastest by google maps.</p>

<figure>
	<a href="/images/pub_2_groc.png"><img src="/images/pub_2_groc.png" /></a>
	<figcaption>Distance to the nearest grocery store from a grid of points in Cambridge.</figcaption>
</figure>

<p>Seeing as I had the data out of google already, I thought I’d chuck in a line and filled
 contour map as well. Below are two plots. First is a normal line map of restaurant 
 density in Cambridge, then a filled contour map of the same data.</p>

<figure class="half">
	<img src="/images/pub_3_a.png" alt="" />
	<img src="/images/pub_3_b.png" alt="" />
	<figcaption>Restaurant density in Cambridge.</figcaption>
</figure>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>ggmap<span class="p">)</span>
 
getLineColor <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>val<span class="p">)</span> <span class="p">{</span>
	<span class="c1">#pal &lt;- colorRampPalette(c(&quot;#333333&quot;, &quot;#ffffff&quot;, &quot;#b5310c&quot;))</span>
	pal <span class="o">&lt;-</span> colorRampPalette<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;#ffffff&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">))</span>
	colors <span class="o">&lt;-</span> pal<span class="p">(</span><span class="m">80</span><span class="p">)</span>
	val.log <span class="o">&lt;-</span> log<span class="p">(</span>val<span class="p">)</span>
	
	<span class="kr">if</span> <span class="p">(</span>val <span class="o">&gt;</span> <span class="m">50</span><span class="p">)</span> <span class="p">{</span>
		col <span class="o">&lt;-</span> colors<span class="p">[</span><span class="m">80</span><span class="p">]</span>
	<span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
		colindex <span class="o">&lt;-</span> max<span class="p">(</span> <span class="m">1</span><span class="p">,</span> round<span class="p">(</span> <span class="m">80</span> <span class="o">*</span> val <span class="o">/</span> <span class="m">50</span> <span class="p">)</span> <span class="p">)</span>
		col <span class="o">&lt;-</span> colors<span class="p">[</span>colindex<span class="p">]</span>
	<span class="p">}</span>
	
	<span class="kr">return</span><span class="p">(</span>col<span class="p">)</span>
<span class="p">}</span>
 
distance <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;nearest-rest.csv&quot;</span><span class="p">,</span> stringsAsFactors<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
 
<span class="c1"># Calculate colors</span>
pts0 <span class="o">&lt;-</span> mapproject<span class="p">(</span>unlist<span class="p">(</span>distance<span class="p">[,</span> <span class="s">&#39;lng&#39;</span><span class="p">]),</span> unlist<span class="p">(</span>distance<span class="p">[,</span> <span class="s">&#39;lat&#39;</span><span class="p">]))</span>
pts1 <span class="o">&lt;-</span> mapproject<span class="p">(</span>unlist<span class="p">(</span>distance<span class="p">[,</span> <span class="s">&#39;lngnear&#39;</span><span class="p">]),</span> unlist<span class="p">(</span>distance<span class="p">[,</span> <span class="s">&#39;latnear&#39;</span><span class="p">]))</span>
seg.colors <span class="o">&lt;-</span> sapply<span class="p">(</span>distance<span class="o">$</span>dist_miles<span class="p">,</span> FUN<span class="o">=</span>getLineColor<span class="p">)</span>
 
<span class="c1">#</span>
<span class="c1"># Map It</span>
<span class="c1">#</span>
 
cam <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;nearest-rest.csv&quot;</span><span class="p">,</span> stringsAsFactors<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
 
<span class="c1"># The box that the data points are within, just top left (lat and long) and bottom right are fed in</span>
<span class="c1"># This box will be taken from google maps. You can also use other mapping sites - see ggmap help for full list.</span>
bbox <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">0.104994</span><span class="p">,</span> <span class="m">52.215382</span><span class="p">,</span> <span class="m">0.149626</span><span class="p">,</span> <span class="m">52.195868</span><span class="p">)</span>
<span class="c1">#get the map from google</span>
basemap <span class="o">&lt;-</span> get_map<span class="p">(</span>location<span class="o">=</span>bbox<span class="p">,</span> zoom<span class="o">=</span><span class="m">14</span><span class="p">,</span> source<span class="o">=</span><span class="s">&#39;google&#39;</span><span class="p">,</span> maptype<span class="o">=</span><span class="s">&quot;terrain&quot;</span><span class="p">,</span> color<span class="o">=</span><span class="s">&quot;bw&quot;</span><span class="p">)</span> 
 
 
<span class="c1">#distance to line map</span>
ggmap<span class="p">(</span>basemap<span class="p">)</span> <span class="o">+</span> geom_segment<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>lng<span class="p">,</span> xend<span class="o">=</span>lngnear<span class="p">,</span> y<span class="o">=</span>lat<span class="p">,</span> yend<span class="o">=</span>latnear<span class="p">,</span> colour<span class="o">=</span>dist_miles<span class="p">),</span> size<span class="o">=</span><span class="m">1</span><span class="p">,</span> data<span class="o">=</span>cam<span class="p">)</span>  <span class="o">+</span> scale_colour_gradient<span class="p">(</span>low<span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span> high<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> limits<span class="o">=</span>c<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0.5</span><span class="p">))</span>
 
<span class="c1">#contour map</span>
ggmap<span class="p">(</span>basemap<span class="p">)</span> <span class="o">+</span> stat_density2d<span class="p">(</span>aes<span class="p">(</span>x<span class="o">=</span>lngnear<span class="p">,</span> y<span class="o">=</span>latnear<span class="p">),</span> data<span class="o">=</span>cam<span class="p">,</span> bins<span class="o">=</span><span class="m">30</span><span class="p">,</span> color<span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span> alpha<span class="o">=</span><span class="m">0.8</span><span class="p">)</span>
 
<span class="c1">#density map</span>
ggmap<span class="p">(</span>basemap<span class="p">)</span> <span class="o">+</span> stat_density2d<span class="p">(</span>aes<span class="p">(</span> x<span class="o">=</span>lngnear<span class="p">,</span>y<span class="o">=</span>latnear<span class="p">,</span> fill<span class="o">=</span>..level.. <span class="p">,</span> alpha<span class="o">=</span>..level.. <span class="p">),</span> data<span class="o">=</span>cam<span class="p">,</span> bins<span class="o">=</span><span class="m">8</span> <span class="p">,</span>alpha<span class="o">=</span><span class="m">0.3</span><span class="p">,</span> geom <span class="o">=</span> <span class="s">&quot;polygon&quot;</span>  <span class="p">)</span> 
</code></pre></div>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Nathan Yau (<strong>2013</strong>) <em>Data Points: Visualization That Means Something</em>, ISBN: 978-1-118-46219-5 <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<div class="entry-related">
					<h2>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h2>
					<ul>
						
						<li><a href="http://epijim.uk/articles/sheep/">New Zealand and sheep</a></li>
						
						<li><a href="http://epijim.uk/articles/bitcoin/">The barons of bitcoin</a></li>
						
						<li><a href="http://epijim.uk/articles/gifsinr/">Animated plots in R</a></li>
						
						<li><a href="http://epijim.uk/articles/hindex/">Publish or perish - there's a model for that.</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<hr />
				<div class="entry-meta">
					<meta itemprop="keywords" content="R, Geo-coding">
					<span class="entry-tags"><a href="http://epijim.uk/tag/r/" title="R" class="tag" rel="tag">R</a><a href="http://epijim.uk/tag/geo-coding/" title="Geo-coding" class="tag" rel="tag">Geo-coding</a></span>
					<span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Published by <span itemprop="name" class="fn"><a href="http://epijim.uk/about/" title="About James Black" itemprop="url">James Black</a></span> on </span>
					<span class="entry-date"><time datetime="2013-11-29T00:00:00+00:00" itemprop="datePublished" class="published updated">November 29, 2013</time></span>
				</div><!-- /.entry-meta -->
			</div><!-- /.entry-content -->
			
			<div id="disqus_thread" class="entry-content"></div><!-- /#disqus_thread -->
			<noscript><div class="upgrade">Please enable JavaScript to view comments.</div><!-- /.upgrade --></noscript>
			
		</div><!-- /.entry-wrapper -->
	</article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <p>&#169; 2004&#8211;2014 <a href="http://epijim.uk/about/">James Black</a>, this site is written in markdown, compiled to html by jekyll, and hosted on github.pages.io. <a href="http://epijim.uk/humans.txt">Theme source and credits here</a>.</p>
		<div class="social-icons">
			
			
			<a href="http://github.com/epijim" title="James Black on Github" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a>
			
			<a href="https://plus.google.com/112022213613617220776/" title="James Black on Google+" target="_blank"><i class="fa fa-google-plus-square fa-fw fa-2x"></i></a>
			
			
		</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" data-cfasync="false"></script>
<script data-cfasync="false">window.jQuery || document.write('<script src="http://epijim.uk/js/vendor/jquery-397754ba49e9e0cf4e7c190da78dda05.js"><\/script>')</script>
<script src="http://epijim.uk/js/main.min-b1c052388578ab3b44858ccabf1f47d6.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
	var _gaq = _gaq || [];
	var pluginUrl = 
	'//www.google-analytics.com/plugins/ga/inpage_linkid.js';
	_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
	_gaq.push(['_setAccount', '']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<!-- Modernizr -->
<script src="http://epijim.uk/js/vendor/modernizr-ab083e250330742e0b9d2a5548ea8745.js"></script>


<!-- Disqus Comments -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesblack'; // Required - Replace example with your forum shortname
    var disqus_title = 'Distance to the nearest pub';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


</body>
</html>
