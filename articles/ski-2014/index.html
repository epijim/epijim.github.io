<!doctype html>
<!--[if lt IE 7]><html class="lt-ie9 lt-ie8 lt-ie7 no-js" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="lt-ie9 lt-ie8 no-js" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="lt-ie9 no-js" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" class="no-js"><!--<![endif]-->

<head>
	<meta charset="utf-8">
	<title>Plotting data from the ski tracks app in R &#8211; James Black</title>
	<meta name="description" content="Plotting data from the ski tracks app using R, from a recent trip to Pitztal Glacier.">
	<meta name="keywords" content="R, Skiing, Map, GPS">
	<!-- Twitter Cards -->
	
		<meta name="twitter:card" content="summary">
			<meta name="twitter:image" content="http://epijim.co.uk/images/ski_thumb.jpeg">
		
	
	<meta name="twitter:title" content="Plotting data from the ski tracks app in R">
	<meta name="twitter:description" content="Plotting data from the ski tracks app using R, from a recent trip to Pitztal Glacier.">
	<meta name="twitter:site" content="@">
	<meta name="twitter:creator" content="@">
	
<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Plotting data from the ski tracks app in R">
<meta property="og:description" content="Plotting data from the ski tracks app using R, from a recent trip to Pitztal Glacier.">
<meta property="og:url" content="http://epijim.co.uk/articles/ski-2014/">
<meta property="og:site_name" content="James Black">

	<!-- Webmaster Tools verifications -->
	
	

	
	<link rel="canonical" href="http://epijim.co.uk/articles/ski-2014/">
	<link href="http://feeds.feedburner.com/epijim" type="application/atom+xml" rel="alternate" title="James Black &#8211; Everything Feed">
	<link rel="author" href="https://plus.google.com/112022213613617220776/?rel=author">

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta http-equiv="cleartype" content="on">

	<!-- For all browsers -->
	<link rel="stylesheet" href="http://epijim.co.uk/css/main.min-92de9747e44e9254411a46b258723e1d.css">

	<!-- Web fonts -->
	<script src="//use.edgefonts.net/lato:n3,i3,n4,i4,n7.js"></script>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">

	<!-- HTML5 Shiv and Media Query Support -->
	<!--[if lt IE 9]>
		<script src="http://epijim.co.uk/js/vendor/html5shiv-5a98a86b5cb48c1506f338463259ce41.js"></script>
		<script src="http://epijim.co.uk/js/vendor/respond-e5d7fffb3a9f891c926ee1b836d448d8.js"></script>
	<![endif]-->

	<!-- Icons -->
	<!-- 16x16 -->
	<link rel="shortcut icon" href="http://epijim.co.uk/favicon.ico">
	<!-- 32x32 -->
	<link rel="shortcut icon" href="http://epijim.co.uk/favicon.png">
	<!-- non-retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon57.png" sizes="57x57">
	<!-- non-retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon72.png" sizes="72x72">
	<!-- non-retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon76.png" sizes="76x76">
	<!-- retina iPhone pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon114.png" sizes="114x114">
	<!-- retina iPhone iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon120.png" sizes="120x120">
	<!-- retina iPad pre iOS 7 -->
	<link rel="apple-touch-icon-precomposed" href="http://epijim.co.uk/images/icon144.png" sizes="144x144">
	<!-- retina iPad iOS 7 -->
	<link rel="apple-touch-icon" href="http://epijim.co.uk/images/icon152.png" sizes="152x152">
	
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47906301-1', 'epijim.co.uk');
  ga('send', 'pageview');

</script>
</head>


<body id="post">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a newer one to better enjoy this site?</a></div><![endif]-->
<div class="masthead-wrapper">
	<header id="masthead" itemscope itemtype="http://schema.org/Organization">
		<a href="http://epijim.co.uk" class="site-logo" rel="home" title="James Black" itemprop="url"><img src="http://epijim.co.uk/images/jimmy_logo.png" width="50" height="50" alt="James Black logo" itemprop="logo"></a>
		<span class="site-title" itemprop="name"><a href="http://epijim.co.uk">James Black</a></span>
	</header><!-- /.masthead -->
	<nav role="navigation" id="site-nav" class="nav">
		<ul>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/" itemprop="url"><span itemprop="name">Home</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/blog/" itemprop="url"><span itemprop="name">Blog</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/plots/" itemprop="url"><span itemprop="name">Gallery</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/my-papers/" itemprop="url"><span itemprop="name">My papers</span></a></li>
		
			<li itemscope itemtype="http://schema.org/SiteNavigationElement"><a href="http://epijim.co.uk/about/" itemprop="url"><span itemprop="name">About me</span></a></li>
		
		</ul>
	</nav><!-- /#site-nav -->
</div><!-- /.entry-wrapper -->

<div id="main" role="main">
		<article class="hentry" itemscope itemtype="http://schema.org/Article">
		<header class="entry-header">
		
			<h1 class="entry-title" itemprop="name">Plotting data from the ski tracks app in R</h1>
		</header>
		<div class="entry-wrapper">
			<div class="entry-content" itemprop="articleBody">
				<p>A week ago Tina and I went skiing at an Austrian resort called Pitztal. While it’s a pretty small
 ski field by European standards<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, Pitztal sits on the highest glacier in 
 Tyrol, and has incredible snow. Below is a map. We mainly skied on the Pitztal Glacier, and only really went across 
 to Rifflsee for the last few runs of the day. </p>

<figure>
	<a href="/images/ski_1_pitztal.jpg"><img src="/images/ski_1_pitztal.jpg" /></a>
	<figcaption>Map of the Pitztal Glacier ski field.</figcaption>
</figure>

<p>While there I used an
 app called <a href="https://itunes.apple.com/gb/app/ski-tracks-gps-track-recorder/id365724094?mt=8">Ski Tracks</a> 
 to record where, when and how fast I skied.</p>

<p>The app actually makes really great graphics, and if you’re not an R fanatic there really isn’t
 a need to pull out the data and re-plot it yourself. Below are some example screens 
 from within the app.</p>

<figure>
	<a href="/images/ski_0_skitracksapp.png"><img src="/images/ski_0_skitracksapp.png" /></a>
	<figcaption>Five example screens from the app.</figcaption>
</figure>

<h2 id="get-the-data-into-r">Get the data into R</h2>

<p>I like the freedom to do what ever I want with the data though, so I pulled it into R.
 There are ready made functions out there to read a gpx file into a data frame<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>, or you 
 can use an online service to convert it to a csv.<sup id="fnref:3"><a href="#fn:3" class="footnote">3</a></sup></p>

<h2 id="define-run-direction">Define run direction</h2>

<p>As you ski down the hill, and ride a gondola up it, it should be easy to code if you are
 actually skiing.</p>

<div class="highlight"><pre><code class="r"><span class="c1"># code if going up or down!</span>
  updown <span class="o">&lt;-</span> sapply<span class="p">(</span><span class="m">1</span><span class="o">:</span>nrow<span class="p">(</span>routes
                                 <span class="p">),</span>
                          <span class="kr">function</span><span class="p">(</span>i<span class="p">)</span> <span class="p">(</span>
                            ifelse<span class="p">((</span>routes<span class="p">[</span>i<span class="p">,</span><span class="s">&quot;elevation&quot;</span><span class="p">]</span> <span class="o">-</span> routes<span class="p">[</span>i<span class="m">-1</span><span class="p">,</span><span class="s">&quot;elevation&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,</span><span class="s">&quot;Up&quot;</span><span class="p">,</span><span class="s">&quot;Down&quot;</span><span class="p">)))</span>
</code></pre></div>

<p>Unfortunately you do go up and down during a run, so I had to do some manual edits after.</p>

<h2 id="day-one-skiing">Day one skiing</h2>

<p>Below is day one of skiing. The code for this plot <a href="http://www.epijim.co.uk/articles/pathsinr/">is here</a>.</p>

<figure class="half">
	<img src="/images/ski_1_sat.png" />
	<img src="/images/ski_2_ter.png" />
	<figcaption>Our first day skiing. On the left the basemap is a satellite photo, on the right it's a terrain map. Lifts are in red, runs in blue.</figcaption>
</figure>

<h2 id="day-one-two-and-three-skiing">Day one, two and three skiing</h2>

<p>At Pitztal, you take an underground train from the village up to the glacier. On the second day 
 we found out it is possible to ski down from the Glacier, all the way through the town, 
 to the gondola that goes up to the other part of the ski field called Rifflsee. This was 
 my favourite run on the mountain, as the one run was a vertical drop from 3,440m to 1,674m.<sup id="fnref:4"><a href="#fn:4" class="footnote">4</a></sup> Meaning you start 
 a couple of hundred metres below the height of Mt Cook (NZ’s biggest mountain), and ski a vertical 
 distance that’s bigger than the distance between the top of Coronet Peak ski field, and sea level.</p>

<p>The best bit of the run that goes between the ski areas was you have to ski through the gate
 below at the start of the trail.</p>

<figure>
	<a href="/images/ski_gif.gif"><img src="/images/ski_gif.gif" /></a>
</figure>

<p>The photo’s below show day one and three overlaid. The blue line linking the two ski fields
 is the epic run mentioned above. </p>

<figure class="half">
	<img src="/images/ski_4a_1n2_ter.png" />
	<img src="/images/ski_4b_1n2_sat.png" />
	<figcaption>First and third day skiing on the same plots. Day one is a lighter blue.</figcaption>
</figure>

<p>According to <em>Ski Tracks</em>, my top speed was over 110 km/hr. Looking at the raw data, there was one
 part of the run where I was at mid-80’s, before suddenly it jumped up 20 km/hr for 3 data points (<em>which was about a second</em>). 
 This is just phone GPS data, and probably full of errors, so I manually subtracted the bonus 20 from those three data points.</p>

<p>In general the <em>Ski Tracks</em> app seems to do some sneaky smoothing when it plots the data in-app.
 The raw data seems to have bigger variations. For one sequence of three data points, my phone claims I went 
 from 76 km/hr to 85 km/hr to 71 km/hr. In just under a second. Because of this, coupled with the implausible 120 km/hr 
 speed burst, I decided I should chuck a rolling average over my speed data.</p>

<div class="highlight"><pre><code class="r">map_data_2_trunc <span class="o">&lt;-</span> map_data_2<span class="p">[</span>
  map_data_2<span class="o">$</span>index <span class="o">%in%</span> names<span class="p">(</span>which<span class="p">(</span>table<span class="p">(</span>map_data_2<span class="o">$</span>index<span class="p">)</span> <span class="o">&gt;</span> <span class="m">10</span><span class="p">)),</span> 
  <span class="p">]</span> <span class="c1"># make a subset of data with just runs over 10 data points (i.e. at least a minute long).</span>

library<span class="p">(</span>zoo<span class="p">)</span> <span class="c1"># zoo has the rollmean function</span>
index <span class="o">&lt;-</span> unique<span class="p">(</span>map_data_2_trunc<span class="o">$</span>index<span class="p">)</span> <span class="c1"># only do rolling average within a run</span>
<span class="kr">for</span><span class="p">(</span>i <span class="kr">in</span> index<span class="p">){</span>
  map_data_2_trunc<span class="p">[</span> 
    which<span class="p">(</span>map_data_2_trunc<span class="o">$</span>index<span class="o">==</span>i<span class="p">),</span>c<span class="p">(</span><span class="s">&quot;speed_roll&quot;</span><span class="p">)</span>
    <span class="p">]</span> <span class="o">&lt;-</span> rollmean<span class="p">(</span>map_data_2_trunc<span class="p">[</span> 
    which<span class="p">(</span>map_data_2_trunc<span class="o">$</span>index<span class="o">==</span>i<span class="p">),</span>c<span class="p">(</span><span class="s">&quot;speed&quot;</span><span class="p">)</span>
    <span class="p">],</span><span class="m">5</span><span class="p">,</span> fill<span class="o">=</span><span class="kc">NA</span><span class="p">)</span> <span class="c1"># Average over 5 points. Note, as at the start of a run you cant</span>
    <span class="c1">#				 have a rolling average, so some data points are lost, </span>
    <span class="c1">#                and become NA.</span>
<span class="p">}</span>
</code></pre></div>

<p>Now plotting the runs, colouring by the rolling average speed.</p>

<figure>
	<a href="/images/ski_5_time.png"><img src="/images/ski_5_time.png" /></a>
	<figcaption>Start and end altitudes of runs on the second day.</figcaption>
</figure>

<p>The data seemed to be the most unreliable for a handful of the runs. In the next dotplot I
 tightened up the code to drop any runs with less than 100 data points, and increased the rolling 
 average to to cover about a 30 seconds of data. I liked how the bits of the run where I 
 usually slow down start to show up.</p>

<p>Code for the dotplot is <a href="http://epijim.co.uk/articles/dotplot/">here</a>.</p>

<figure>
	<a href="/images/ski_6_runs.png"><img src="/images/ski_6_runs.png" /></a>
	<figcaption>A dotplot of rolling average speed accross a selected sub sample of runs on the second day.</figcaption>
</figure>

<p>Finally, a 3D scatter plot of the runs from day two. The 3D scatter plot is super simple to make: 
code <a href="http://epijim.co.uk/articles/3Dscatter/">is here</a>.</p>

<figure>
	<a href="/images/ski_scattergif.gif"><img src="/images/ski_scattergif.gif" /></a>
</figure>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Pitztal has 40.6 km of runs accross Rifflsee and the Glacier. Arlberg, Kaprun, SkiWelt and Ischgil are all Austrian ski fields with more than 220km of piste. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p><a href="http://plotkml.r-forge.r-project.org/readGPX.html">readGPX</a> is an example from CRAN. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:3">
      <p>An example of a free service is <a href="http://www.gpsvisualizer.com/convert_input">GPS visualiser</a> <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>If you started at the top of the highest gondola at Pitztal. <a href="#fnref:4" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

				<div class="entry-related">
					<h2>Related Articles <a href="#" onclick="(function(btn){var z=document.createElement('script');document.subtomeBtn=btn;z.src='https://www.subtome.com/load.js';document.body.appendChild(z);})(this);_gaq.push(['_trackEvent', 'Link', 'Subscribe']);" data-subtome-resource="http://epijim.co.uk" data-subtome-feeds="http://feeds.feedburner.com/epijim"><i class="fa fa-rss fa-fw"></i></a></h2>
					<ul>
						
						<li><a href="http://epijim.co.uk/articles/3Dscatter/">3D scatter plot in R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/pathsinr/">Plotting paths in R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/dotplot/">Making a dotplot in R</a></li>
						
						<li><a href="http://epijim.co.uk/articles/restaurant-hygiene/">Restaurant hygiene ratings in Cambridge</a></li>
						
					</ul>
				</div><!-- /.entry-related -->
				<hr />
				<div class="entry-meta">
					<meta itemprop="keywords" content="R, Skiing, Map, GPS">
					<span class="entry-tags"><a href="http://epijim.co.uk/tag/r/" title="R" class="tag" rel="tag">R</a><a href="http://epijim.co.uk/tag/skiing/" title="Skiing" class="tag" rel="tag">Skiing</a><a href="http://epijim.co.uk/tag/map/" title="Map" class="tag" rel="tag">Map</a><a href="http://epijim.co.uk/tag/gps/" title="GPS" class="tag" rel="tag">GPS</a></span>
					<span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person">Published by <span itemprop="name" class="fn"><a href="http://epijim.co.uk/about/" title="About James Black" itemprop="url">James Black</a></span> on </span>
					<span class="entry-date"><time datetime="2014-03-09T00:00:00+00:00" itemprop="datePublished" class="published updated">March 09, 2014</time></span>
				</div><!-- /.entry-meta -->
			</div><!-- /.entry-content -->
			
			<div id="disqus_thread" class="entry-content"></div><!-- /#disqus_thread -->
			<noscript><div class="upgrade">Please enable JavaScript to view comments.</div><!-- /.upgrade --></noscript>
			
		</div><!-- /.entry-wrapper -->
	</article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <p>&#169; 2004&#8211;2014 <a href="http://epijim.co.uk/about/">James Black</a>, this site is written in markdown, compiled to html by jekyll, and hosted on github.pages.io. <a href="http://epijim.co.uk/humans.txt">Theme source and credits here</a>.</p>
		<div class="social-icons">
			
			
			<a href="http://github.com/epijim" title="James Black on Github" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a>
			
			<a href="https://plus.google.com/112022213613617220776/" title="James Black on Google+" target="_blank"><i class="fa fa-google-plus-square fa-fw fa-2x"></i></a>
			
			
		</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" data-cfasync="false"></script>
<script data-cfasync="false">window.jQuery || document.write('<script src="http://epijim.co.uk/js/vendor/jquery-397754ba49e9e0cf4e7c190da78dda05.js"><\/script>')</script>
<script src="http://epijim.co.uk/js/main.min-b1c052388578ab3b44858ccabf1f47d6.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
	var _gaq = _gaq || [];
	var pluginUrl = 
	'//www.google-analytics.com/plugins/ga/inpage_linkid.js';
	_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
	_gaq.push(['_setAccount', '']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<!-- Modernizr -->
<script src="http://epijim.co.uk/js/vendor/modernizr-ab083e250330742e0b9d2a5548ea8745.js"></script>


<!-- Disqus Comments -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jamesblack'; // Required - Replace example with your forum shortname
    var disqus_title = 'Plotting data from the ski tracks app in R';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>


</body>
</html>
